<div class="enterprise-tab-component">
    <div class="enterprise-banner">
        <div class="banner-content">
            <h3>üè¢ Enterprise Vault Management</h3>
            <p>Advanced controls for Tier 4+ operators with sovereign access</p>
            <div class="tier-badge">
                <span class="badge-icon">üëë</span>
                <span class="badge-text">Tier <span id="enterpriseTier">4</span></span>
            </div>
        </div>
    </div>

    <div class="enterprise-grid">
        <!-- Vault Override Manager -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üîê</span>
                <h4>Vault Override Manager</h4>
            </div>
            <div class="card-body">
                <p>Manage API keys, signatures, and vault access controls</p>
                
                <div class="override-section">
                    <h5>API Key Overrides</h5>
                    <div class="key-list">
                        <div class="key-item">
                            <span class="key-provider">Claude</span>
                            <input type="password" value="sk-************" readonly>
                            <button class="btn-small" onclick="editKey('claude')">Edit</button>
                        </div>
                        <div class="key-item">
                            <span class="key-provider">OpenAI</span>
                            <input type="password" value="sk-************" readonly>
                            <button class="btn-small" onclick="editKey('openai')">Edit</button>
                        </div>
                    </div>
                </div>
                
                <div class="override-section">
                    <h5>Sovereign Signature</h5>
                    <div class="signature-display">
                        <code id="sovereignSig">cal-riven-sovereign-************</code>
                        <button class="btn-small" onclick="regenerateSignature()">Regenerate</button>
                    </div>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-primary" onclick="saveOverrides()">Save Overrides</button>
            </div>
        </div>

        <!-- Agent Rerouting Tool -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üîÄ</span>
                <h4>Agent Rerouting Tool</h4>
            </div>
            <div class="card-body">
                <p>Redirect agent traffic and manage routing rules</p>
                
                <div class="routing-rules">
                    <h5>Active Routes</h5>
                    <div class="route-list">
                        <div class="route-item">
                            <span class="route-from">All Agents</span>
                            <span class="route-arrow">‚Üí</span>
                            <span class="route-to">Sovereign Vault</span>
                            <button class="btn-small danger" onclick="removeRoute(0)">Remove</button>
                        </div>
                    </div>
                    
                    <div class="add-route">
                        <h5>Add New Route</h5>
                        <div class="route-form">
                            <select id="routeFrom">
                                <option value="all">All Agents</option>
                                <option value="specific">Specific Agent</option>
                                <option value="tier">By Tier</option>
                            </select>
                            <span class="route-arrow">‚Üí</span>
                            <select id="routeTo">
                                <option value="vault">Sovereign Vault</option>
                                <option value="platform">Platform Wrapper</option>
                                <option value="llm">LLM Router</option>
                                <option value="local">Local Fork</option>
                            </select>
                            <button class="btn-primary" onclick="addRoute()">Add Route</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent Monetization -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üí∞</span>
                <h4>Agent Template Marketplace</h4>
            </div>
            <div class="card-body">
                <p>Monetize your custom agent templates</p>
                
                <div class="monetization-stats">
                    <div class="stat-row">
                        <span>Templates Listed:</span>
                        <strong id="templatesListed">0</strong>
                    </div>
                    <div class="stat-row">
                        <span>Total Sales:</span>
                        <strong id="totalSales">0</strong>
                    </div>
                    <div class="stat-row">
                        <span>Revenue:</span>
                        <strong>$<span id="totalRevenue">0</span></strong>
                    </div>
                </div>
                
                <div class="template-actions">
                    <button class="btn-primary" onclick="createPaidAgent()">
                        <span class="btn-icon">üöÄ</span>
                        Launch Paid Agent
                    </button>
                    <button class="btn-secondary" onclick="viewMarketplace()">
                        Browse Marketplace
                    </button>
                </div>
                
                <div class="payment-setup">
                    <h5>Payment Integration</h5>
                    <div class="integration-status">
                        <div class="integration-item">
                            <span>Stripe:</span>
                            <span class="status connected">Connected</span>
                            <button class="btn-small" onclick="configureStripe()">Configure</button>
                        </div>
                        <div class="integration-item">
                            <span>Revenue Share:</span>
                            <strong>70%</strong> to you
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clone & Sell Platform -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üè¢</span>
                <h4>Clone & Sell Platform</h4>
            </div>
            <div class="card-body">
                <p>White-label MirrorOS for enterprise clients</p>
                
                <div class="platform-packages">
                    <div class="package-card">
                        <h5>Starter Package</h5>
                        <div class="package-price">$500</div>
                        <ul>
                            <li>Basic platform clone</li>
                            <li>5 agent templates</li>
                            <li>Email support</li>
                        </ul>
                    </div>
                    <div class="package-card featured">
                        <h5>Professional</h5>
                        <div class="package-price">$2000</div>
                        <ul>
                            <li>Custom branding</li>
                            <li>20 agent templates</li>
                            <li>Priority support</li>
                            <li>Training session</li>
                        </ul>
                    </div>
                    <div class="package-card">
                        <h5>Enterprise</h5>
                        <div class="package-price">$5000+</div>
                        <ul>
                            <li>Full white-label</li>
                            <li>Unlimited agents</li>
                            <li>Dedicated support</li>
                            <li>Custom features</li>
                        </ul>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="createEnterpriseClone()">
                    Create Enterprise Clone
                </button>
            </div>
        </div>

        <!-- Clone Vault -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üß¨</span>
                <h4>Clone Vault</h4>
            </div>
            <div class="card-body">
                <p>Create a new platform clone with current vault state</p>
                
                <div class="clone-info">
                    <div class="info-row">
                        <span>Current Clone:</span>
                        <strong>cal-riven-core-1750045419</strong>
                    </div>
                    <div class="info-row">
                        <span>Platform Depth:</span>
                        <strong>Tier -10</strong>
                    </div>
                    <div class="info-row">
                        <span>Vault Status:</span>
                        <span class="status-badge active">Mounted</span>
                    </div>
                </div>
                
                <div class="clone-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="cloneTemplates" checked>
                        Include template reflections
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="cloneAgents" checked>
                        Include agent configurations
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="cloneLogs">
                        Include reflection logs
                    </label>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-primary" onclick="cloneVault()">
                    <span class="btn-icon">üîÑ</span>
                    Clone Platform
                </button>
            </div>
        </div>

        <!-- Fork Log Viewer -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üìä</span>
                <h4>Fork Log Viewer</h4>
            </div>
            <div class="card-body">
                <p>Detailed analytics and logs from platform forks</p>
                
                <div class="log-filters">
                    <select id="logFilter">
                        <option value="all">All Events</option>
                        <option value="fork">Fork Events</option>
                        <option value="loop">Loop Closures</option>
                        <option value="reflection">Reflections</option>
                        <option value="error">Errors</option>
                    </select>
                    <button class="btn-secondary" onclick="exportLogs()">Export</button>
                </div>
                
                <div class="log-viewer">
                    <div class="log-entry">
                        <span class="log-time">2025-01-16 03:45:23</span>
                        <span class="log-type fork">FORK</span>
                        <span class="log-message">Agent fork-a3b2c1 created from vault-origin</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">2025-01-16 03:45:19</span>
                        <span class="log-type loop">LOOP</span>
                        <span class="log-message">Loop closure detected: agent-x7y9 ‚Üí vault</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">2025-01-16 03:44:52</span>
                        <span class="log-type reflection">REFLECT</span>
                        <span class="log-message">Prompt routed through sovereign kernel</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drift Pattern Viewer -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üìà</span>
                <h4>Drift Pattern Viewer</h4>
            </div>
            <div class="card-body">
                <p>Monitor entropy and drift patterns in the vault</p>
                
                <div class="drift-metrics">
                    <div class="metric">
                        <span class="metric-label">Current Entropy</span>
                        <span class="metric-value">0.127</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: 12.7%"></div>
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Drift Threshold</span>
                        <span class="metric-value">0.15</span>
                        <div class="metric-bar threshold">
                            <div class="metric-fill" style="width: 15%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="drift-status">
                    <span class="status-icon">‚úÖ</span>
                    <span>Vault drift within acceptable limits</span>
                </div>
            </div>
        </div>

        <!-- Enterprise Config Manager -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">‚öôÔ∏è</span>
                <h4>Enterprise Config</h4>
            </div>
            <div class="card-body">
                <p>Manage enterprise configuration files</p>
                
                <div class="config-editor">
                    <div class="config-tabs">
                        <button class="config-tab active" data-config="platform">platform.json</button>
                        <button class="config-tab" data-config="vault">vault-config.json</button>
                        <button class="config-tab" data-config="mesh">mesh-config.json</button>
                    </div>
                    
                    <textarea id="configEditor" class="config-textarea">{
  "platform": "cal-riven-core",
  "tier": -10,
  "sovereign": true,
  "reflection": {
    "enabled": true,
    "depth": "infinite"
  }
}</textarea>
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-secondary" onclick="validateConfig()">Validate</button>
                <button class="btn-primary" onclick="saveConfig()">Save Config</button>
            </div>
        </div>
        
        <!-- Integration Panel -->
        <div class="enterprise-card">
            <div class="card-header">
                <span class="card-icon">üîå</span>
                <h4>Platform Integrations</h4>
            </div>
            <div class="card-body">
                <p>Connect external services to expand vault capabilities</p>
                
                <!-- GitHub Integration -->
                <div class="integration-section">
                    <h5>üîê GitHub Integration</h5>
                    <div class="integration-content">
                        <div class="form-group">
                            <label for="githubToken">Personal Access Token</label>
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                            <small>Grants access to private repositories</small>
                        </div>
                        <button class="btn-primary" onclick="connectGitHub()">Connect GitHub</button>
                        <div id="githubStatus" class="integration-status"></div>
                        <div id="githubRepos" class="repo-list" style="display: none;">
                            <h6>Connected Repositories</h6>
                            <div class="repo-items"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Supabase/Firebase Integration -->
                <div class="integration-section">
                    <h5>üîó External Database</h5>
                    <div class="integration-tabs">
                        <button class="integration-tab active" data-db="supabase">Supabase</button>
                        <button class="integration-tab" data-db="firebase">Firebase</button>
                    </div>
                    <div class="integration-content" id="supabaseConfig">
                        <div class="form-group">
                            <label for="supabaseUrl">Project URL</label>
                            <input type="text" id="supabaseUrl" placeholder="https://xxx.supabase.co">
                        </div>
                        <div class="form-group">
                            <label for="supabaseKey">Anon Key</label>
                            <input type="password" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                        </div>
                        <button class="btn-primary" onclick="connectSupabase()">Connect Supabase</button>
                    </div>
                    <div class="integration-content" id="firebaseConfig" style="display: none;">
                        <div class="form-group">
                            <label for="firebaseConfig">Firebase Config JSON</label>
                            <textarea id="firebaseConfigJson" rows="4" placeholder='{"apiKey": "...", "authDomain": "..."}'></textarea>
                        </div>
                        <button class="btn-primary" onclick="connectFirebase()">Connect Firebase</button>
                    </div>
                    <div id="dbStatus" class="integration-status"></div>
                </div>
                
                <!-- Stripe Integration -->
                <div class="integration-section">
                    <h5>üí≥ Stripe Connect</h5>
                    <div class="integration-content">
                        <div class="form-group">
                            <label for="stripeKey">Publishable Key</label>
                            <input type="text" id="stripeKey" placeholder="pk_live_xxxxxxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label for="stripeSecret">Secret Key</label>
                            <input type="password" id="stripeSecret" placeholder="sk_live_xxxxxxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>Monetization Options</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="stripeAgents" checked> Agent Marketplace</label>
                                <label><input type="checkbox" id="stripeAutomations" checked> Automation Sales</label>
                                <label><input type="checkbox" id="stripePlatforms" checked> Platform Clones</label>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="connectStripe()">Connect Stripe</button>
                        <div id="stripeStatus" class="integration-status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Log by UUID -->
    <div class="enterprise-section">
        <h3>Prompt Log Viewer</h3>
        <div class="uuid-search">
            <input type="text" id="uuidSearch" placeholder="Enter prompt UUID...">
            <button class="btn-primary" onclick="searchPromptLog()">Search</button>
        </div>
        
        <div id="promptLogResult" class="prompt-log-result" style="display: none;">
            <div class="log-header">
                <h4>Prompt Details</h4>
                <code id="promptUuid">-</code>
            </div>
            <div class="log-details">
                <div class="detail-row">
                    <span>Timestamp:</span>
                    <span id="promptTimestamp">-</span>
                </div>
                <div class="detail-row">
                    <span>User Tier:</span>
                    <span id="promptUserTier">-</span>
                </div>
                <div class="detail-row">
                    <span>LLM Used:</span>
                    <span id="promptLLM">-</span>
                </div>
                <div class="detail-row">
                    <span>Reflection Depth:</span>
                    <span id="promptDepth">-</span>
                </div>
                <div class="detail-section">
                    <h5>Original Prompt</h5>
                    <div id="originalPrompt" class="prompt-content">-</div>
                </div>
                <div class="detail-section">
                    <h5>Enhanced Prompt</h5>
                    <div id="enhancedPrompt" class="prompt-content">-</div>
                </div>
                <div class="detail-section">
                    <h5>Response</h5>
                    <div id="promptResponse" class="prompt-content">-</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.enterprise-tab-component {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.enterprise-banner {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow);
}

.banner-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.banner-content h3 {
    margin-bottom: 0.25rem;
}

.tier-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2rem;
    font-weight: 600;
}

.badge-icon {
    font-size: 1.25rem;
}

.enterprise-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
}

.enterprise-card {
    background: var(--surface);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.card-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    background: var(--background);
    border-bottom: 1px solid var(--border-color);
}

.card-icon {
    font-size: 1.5rem;
}

.card-header h4 {
    margin: 0;
}

.card-body {
    padding: 1.5rem;
    flex: 1;
}

.card-body > p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    font-size: 0.875rem;
}

.card-actions {
    padding: 1rem 1.5rem;
    background: var(--background);
    border-top: 1px solid var(--border-color);
}

/* Vault Override Manager */
.override-section {
    margin-bottom: 1.5rem;
}

.override-section h5 {
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
}

.key-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.key-item {
    display: grid;
    grid-template-columns: 80px 1fr auto;
    gap: 0.75rem;
    align-items: center;
}

.key-provider {
    font-size: 0.875rem;
    font-weight: 500;
}

.key-item input {
    padding: 0.375rem 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    font-family: monospace;
    font-size: 0.875rem;
}

.btn-small {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    cursor: pointer;
}

.btn-small:hover {
    background: var(--border-color);
}

.signature-display {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.signature-display code {
    flex: 1;
    padding: 0.5rem 0.75rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    font-size: 0.875rem;
}

/* Agent Rerouting */
.routing-rules {
    margin-bottom: 1.5rem;
}

.route-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.route-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
}

.route-from,
.route-to {
    font-size: 0.875rem;
}

.route-arrow {
    color: var(--text-secondary);
}

.route-form {
    display: grid;
    grid-template-columns: 1fr auto 1fr auto;
    gap: 0.75rem;
    align-items: center;
}

.route-form select {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-size: 0.875rem;
}

/* Clone Vault */
.clone-info {
    margin-bottom: 1.5rem;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.875rem;
}

.info-row:last-child {
    border-bottom: none;
}

.status-badge {
    padding: 0.25rem 0.5rem;
    background: var(--danger-color);
    color: white;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.status-badge.active {
    background: var(--success-color);
}

.clone-options {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

/* Fork Log Viewer */
.log-filters {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.log-filters select {
    flex: 1;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-size: 0.875rem;
}

.log-viewer {
    max-height: 200px;
    overflow-y: auto;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    padding: 0.75rem;
}

.log-entry {
    display: grid;
    grid-template-columns: 140px 60px 1fr;
    gap: 0.75rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.75rem;
}

.log-entry:last-child {
    border-bottom: none;
}

.log-time {
    color: var(--text-secondary);
}

.log-type {
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    text-align: center;
    font-weight: 500;
}

.log-type.fork {
    background: rgba(99, 102, 241, 0.2);
    color: var(--primary-color);
}

.log-type.loop {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-color);
}

.log-type.reflection {
    background: rgba(139, 92, 246, 0.2);
    color: var(--secondary-color);
}

.log-type.error {
    background: rgba(239, 68, 68, 0.2);
    color: var(--danger-color);
}

/* Drift Pattern Viewer */
.drift-metrics {
    margin-bottom: 1.5rem;
}

.metric {
    margin-bottom: 1rem;
}

.metric-label {
    display: block;
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.metric-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color);
}

.metric-bar {
    height: 8px;
    background: var(--border-color);
    border-radius: 4px;
    margin-top: 0.5rem;
    overflow: hidden;
}

.metric-fill {
    height: 100%;
    background: var(--primary-color);
    transition: width 0.3s ease;
}

.metric-bar.threshold .metric-fill {
    background: var(--warning-color);
}

.drift-status {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 0.375rem;
    font-size: 0.875rem;
}

.status-icon {
    font-size: 1.25rem;
}

/* Config Manager */
.config-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.config-tab {
    padding: 0.375rem 0.75rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem 0.25rem 0 0;
    cursor: pointer;
    font-size: 0.75rem;
}

.config-tab.active {
    background: var(--surface);
    border-bottom-color: var(--surface);
}

.config-textarea {
    width: 100%;
    height: 150px;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0 0.375rem 0.375rem 0.375rem;
    font-family: monospace;
    font-size: 0.75rem;
    resize: vertical;
}

/* Prompt Log Viewer */
.enterprise-section {
    background: var(--surface);
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow);
}

.enterprise-section h3 {
    margin-bottom: 1.5rem;
}

/* Integration Styles */
.integration-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
}

.integration-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.integration-section h5 {
    margin-bottom: 1rem;
    font-size: 1rem;
}

.integration-content {
    margin-top: 1rem;
}

.integration-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.integration-tab {
    padding: 0.375rem 0.75rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.25rem;
    cursor: pointer;
    font-size: 0.875rem;
}

.integration-tab.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.integration-status {
    margin-top: 1rem;
    padding: 0.75rem;
    background: var(--background);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    display: none;
}

.integration-status.success {
    display: block;
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.integration-status.error {
    display: block;
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.repo-list {
    margin-top: 1rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    padding: 1rem;
}

.repo-list h6 {
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
}

.repo-items {
    max-height: 200px;
    overflow-y: auto;
}

.repo-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.875rem;
}

.repo-item:last-child {
    border-bottom: none;
}

.repo-tag {
    padding: 0.125rem 0.375rem;
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary-color);
    border-radius: 0.25rem;
    font-size: 0.75rem;
}

.uuid-search {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.uuid-search input {
    flex: 1;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
}

.prompt-log-result {
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    overflow: hidden;
}

.log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: var(--surface);
    border-bottom: 1px solid var(--border-color);
}

.log-header code {
    font-size: 0.875rem;
}

.log-details {
    padding: 1.5rem;
}

.detail-section {
    margin-top: 1.5rem;
}

.detail-section h5 {
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
}

.prompt-content {
    padding: 1rem;
    background: var(--surface);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
}

@media (max-width: 1024px) {
    .enterprise-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Enterprise functions
window.editKey = function(provider) {
    const input = event.target.parentElement.querySelector('input');
    input.readOnly = !input.readOnly;
    event.target.textContent = input.readOnly ? 'Edit' : 'Save';
};

window.regenerateSignature = function() {
    const newSig = `cal-riven-sovereign-${Math.random().toString(36).substr(2, 16)}`;
    document.getElementById('sovereignSig').textContent = newSig;
    window.dashboard.showNotification('Sovereign signature regenerated', 'success');
};

window.saveOverrides = function() {
    window.dashboard.showNotification('Vault overrides saved', 'success');
};

window.addRoute = function() {
    const from = document.getElementById('routeFrom').value;
    const to = document.getElementById('routeTo').value;
    window.dashboard.showNotification(`Route added: ${from} ‚Üí ${to}`, 'success');
};

window.removeRoute = function(index) {
    window.dashboard.showNotification('Route removed', 'success');
};

window.cloneVault = async function() {
    if (!confirm('Create a new platform clone with current vault state?')) return;
    
    try {
        const response = await fetch('/api/vault/clone', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                includeTemplates: document.getElementById('cloneTemplates').checked,
                includeAgents: document.getElementById('cloneAgents').checked,
                includeLogs: document.getElementById('cloneLogs').checked
            })
        });
        
        const result = await response.json();
        window.dashboard.showNotification(`Platform cloned: ${result.cloneId}`, 'success');
    } catch (error) {
        window.dashboard.showNotification('Clone failed', 'error');
    }
};

window.exportLogs = function() {
    window.dashboard.showNotification('Logs exported to downloads', 'success');
};

window.validateConfig = function() {
    try {
        JSON.parse(document.getElementById('configEditor').value);
        window.dashboard.showNotification('Configuration is valid', 'success');
    } catch (error) {
        window.dashboard.showNotification('Invalid JSON configuration', 'error');
    }
};

window.saveConfig = function() {
    window.dashboard.showNotification('Configuration saved', 'success');
};

window.searchPromptLog = async function() {
    const uuid = document.getElementById('uuidSearch').value;
    if (!uuid) return;
    
    // Mock data for demonstration
    document.getElementById('promptLogResult').style.display = 'block';
    document.getElementById('promptUuid').textContent = uuid;
    document.getElementById('promptTimestamp').textContent = new Date().toLocaleString();
    document.getElementById('promptUserTier').textContent = 'Tier 4';
    document.getElementById('promptLLM').textContent = 'Claude';
    document.getElementById('promptDepth').textContent = '3';
    document.getElementById('originalPrompt').textContent = 'What is the nature of consciousness?';
    document.getElementById('enhancedPrompt').textContent = '[Enhanced by sovereign vault]\nReflect deeply on: What is the nature of consciousness?';
    document.getElementById('promptResponse').textContent = 'Consciousness emerges from the sovereign reflection...';
};

// Monetization functions
window.createPaidAgent = function() {
    const modal = document.getElementById('inviteModal') || createModal();
    document.getElementById('inviteModalTitle').textContent = 'Create Paid Agent Template';
    document.getElementById('inviteModalContent').innerHTML = `
        <div class="paid-agent-form">
            <div class="form-group">
                <label for="paidAgentName">Template Name</label>
                <input type="text" id="paidAgentName" placeholder="Advanced Analytics Agent">
            </div>
            <div class="form-group">
                <label for="paidAgentPrice">Price (USD)</label>
                <input type="number" id="paidAgentPrice" min="5" max="500" value="29" step="1">
            </div>
            <div class="form-group">
                <label for="paidAgentDesc">Description</label>
                <textarea id="paidAgentDesc" rows="3" placeholder="What makes this agent special?"></textarea>
            </div>
            <div class="form-group">
                <label>Features</label>
                <div class="feature-checks">
                    <label><input type="checkbox" checked> Advanced reasoning</label>
                    <label><input type="checkbox" checked> Custom training data</label>
                    <label><input type="checkbox"> Priority support</label>
                    <label><input type="checkbox"> White-label option</label>
                </div>
            </div>
            <div class="stripe-preview">
                <h5>Stripe Checkout Preview</h5>
                <div class="checkout-preview">
                    <div class="preview-price">$29.00</div>
                    <div class="preview-revenue">You earn: $20.30 (70%)</div>
                </div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
};

window.viewMarketplace = function() {
    window.open('https://marketplace.mirrorOS.ai', '_blank');
};

window.configureStripe = function() {
    window.dashboard.showNotification('Opening Stripe configuration...', 'info');
    window.open('https://dashboard.stripe.com/connect/accounts', '_blank');
};

window.createEnterpriseClone = function() {
    const modal = document.getElementById('inviteModal') || createModal();
    document.getElementById('inviteModalTitle').textContent = 'Create Enterprise Clone';
    document.getElementById('inviteModalContent').innerHTML = `
        <div class="enterprise-clone-form">
            <div class="form-group">
                <label for="clientName">Client Name</label>
                <input type="text" id="clientName" placeholder="Acme Corporation">
            </div>
            <div class="form-group">
                <label for="packageSelect">Package</label>
                <select id="packageSelect">
                    <option value="starter">Starter - $500</option>
                    <option value="professional" selected>Professional - $2000</option>
                    <option value="enterprise">Enterprise - $5000+</option>
                </select>
            </div>
            <div class="form-group">
                <label>Customizations</label>
                <div class="custom-options">
                    <label><input type="checkbox" id="customBranding"> Custom branding</label>
                    <label><input type="checkbox" id="customDomain"> Custom domain</label>
                    <label><input type="checkbox" id="apiAccess"> API access</label>
                    <label><input type="checkbox" id="training"> Training included</label>
                </div>
            </div>
            <div class="clone-summary">
                <h5>Clone Summary</h5>
                <div class="summary-item">
                    <span>Base Price:</span>
                    <strong id="basePrice">$2000</strong>
                </div>
                <div class="summary-item">
                    <span>Your Commission (30%):</span>
                    <strong id="commission">$600</strong>
                </div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
    
    // Update pricing on change
    document.getElementById('packageSelect').addEventListener('change', updateClonePricing);
};

function updateClonePricing() {
    const prices = {
        starter: 500,
        professional: 2000,
        enterprise: 5000
    };
    const selected = document.getElementById('packageSelect').value;
    const price = prices[selected];
    const commission = price * 0.3;
    
    document.getElementById('basePrice').textContent = `$${price}`;
    document.getElementById('commission').textContent = `$${commission}`;
}

function createModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.id = 'inviteModal';
    modal.innerHTML = `
        <div class="modal-content">
            <h3 id="inviteModalTitle"></h3>
            <div id="inviteModalContent"></div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="this.closest('.modal').style.display='none'">Cancel</button>
                <button class="btn-primary" onclick="confirmModalAction()">Confirm</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    return modal;
}

window.confirmModalAction = function() {
    window.dashboard.showNotification('Action completed successfully!', 'success');
    document.getElementById('inviteModal').style.display = 'none';
};

// Integration functions
window.connectGitHub = async function() {
    const token = document.getElementById('githubToken').value;
    if (!token) {
        window.dashboard.showNotification('Please enter a GitHub token', 'error');
        return;
    }
    
    const statusDiv = document.getElementById('githubStatus');
    statusDiv.className = 'integration-status';
    statusDiv.textContent = 'Connecting to GitHub...';
    statusDiv.style.display = 'block';
    
    try {
        // Test token and fetch repos
        const response = await fetch('https://api.github.com/user/repos', {
            headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        if (!response.ok) throw new Error('Invalid token');
        
        const repos = await response.json();
        
        // Save to vault
        await saveIntegration('github', {
            token: token,
            connected: true,
            repos: repos.map(r => ({ name: r.full_name, private: r.private }))
        });
        
        statusDiv.className = 'integration-status success';
        statusDiv.textContent = `‚úÖ Connected! Found ${repos.length} repositories`;
        
        // Display repos
        const repoList = document.getElementById('githubRepos');
        const repoItems = repoList.querySelector('.repo-items');
        repoItems.innerHTML = repos.slice(0, 10).map(repo => `
            <div class="repo-item">
                <span>${repo.full_name}</span>
                <span class="repo-tag">mirror-synced</span>
            </div>
        `).join('');
        repoList.style.display = 'block';
        
        // Tag repos with mirror keys
        await tagRepositories(repos, token);
        
    } catch (error) {
        statusDiv.className = 'integration-status error';
        statusDiv.textContent = '‚ùå Connection failed: ' + error.message;
    }
};

window.connectSupabase = async function() {
    const url = document.getElementById('supabaseUrl').value;
    const key = document.getElementById('supabaseKey').value;
    
    if (!url || !key) {
        window.dashboard.showNotification('Please fill in all fields', 'error');
        return;
    }
    
    const statusDiv = document.getElementById('dbStatus');
    statusDiv.className = 'integration-status';
    statusDiv.textContent = 'Connecting to Supabase...';
    statusDiv.style.display = 'block';
    
    try {
        // Save to vault
        await saveIntegration('supabase', {
            url: url,
            anonKey: key,
            connected: true,
            syncEnabled: true
        });
        
        statusDiv.className = 'integration-status success';
        statusDiv.textContent = '‚úÖ Supabase connected! Logs will sync to your database';
        
        // Start syncing logs
        await startLogSync('supabase', { url, key });
        
    } catch (error) {
        statusDiv.className = 'integration-status error';
        statusDiv.textContent = '‚ùå Connection failed: ' + error.message;
    }
};

window.connectFirebase = async function() {
    const configJson = document.getElementById('firebaseConfigJson').value;
    
    try {
        const config = JSON.parse(configJson);
        
        const statusDiv = document.getElementById('dbStatus');
        statusDiv.className = 'integration-status';
        statusDiv.textContent = 'Connecting to Firebase...';
        statusDiv.style.display = 'block';
        
        // Save to vault
        await saveIntegration('firebase', {
            config: config,
            connected: true,
            syncEnabled: true
        });
        
        statusDiv.className = 'integration-status success';
        statusDiv.textContent = '‚úÖ Firebase connected! Logs will sync to Firestore';
        
        // Start syncing logs
        await startLogSync('firebase', config);
        
    } catch (error) {
        const statusDiv = document.getElementById('dbStatus');
        statusDiv.className = 'integration-status error';
        statusDiv.textContent = '‚ùå Invalid configuration: ' + error.message;
    }
};

window.connectStripe = async function() {
    const publishableKey = document.getElementById('stripeKey').value;
    const secretKey = document.getElementById('stripeSecret').value;
    
    if (!publishableKey || !secretKey) {
        window.dashboard.showNotification('Please enter both keys', 'error');
        return;
    }
    
    const statusDiv = document.getElementById('stripeStatus');
    statusDiv.className = 'integration-status';
    statusDiv.textContent = 'Connecting to Stripe...';
    statusDiv.style.display = 'block';
    
    try {
        const options = {
            agents: document.getElementById('stripeAgents').checked,
            automations: document.getElementById('stripeAutomations').checked,
            platforms: document.getElementById('stripePlatforms').checked
        };
        
        // Save to vault
        await saveIntegration('stripe', {
            publishableKey: publishableKey,
            secretKey: secretKey,
            monetization: options,
            connected: true
        });
        
        statusDiv.className = 'integration-status success';
        statusDiv.textContent = '‚úÖ Stripe connected! Monetization features enabled';
        
        window.dashboard.showNotification('You can now sell agents and automations!', 'success');
        
    } catch (error) {
        statusDiv.className = 'integration-status error';
        statusDiv.textContent = '‚ùå Connection failed: ' + error.message;
    }
};

// Helper functions
async function saveIntegration(service, config) {
    const integration = {
        service: service,
        config: config,
        timestamp: Date.now(),
        mirrorSignature: generateMirrorSignature(config)
    };
    
    // Save to vault
    await fetch('/api/vault/integrations/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(integration)
    });
    
    // Log to trace map
    await logToTraceMap({
        type: 'integration-connected',
        service: service,
        timestamp: Date.now()
    });
}

async function tagRepositories(repos, token) {
    for (const repo of repos.slice(0, 10)) {
        const mirrorKey = `mirror-${repo.name.replace('/', '-')}-${Date.now()}`;
        const reflectionData = {
            mirrorKey: mirrorKey,
            synced: true,
            vaultAccess: 'read',
            timestamp: Date.now()
        };
        
        // Create repo-reflection.json
        try {
            await fetch(`https://api.github.com/repos/${repo.full_name}/contents/.mirror/repo-reflection.json`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: 'üîÆ Add MirrorOS reflection metadata',
                    content: btoa(JSON.stringify(reflectionData, null, 2))
                })
            });
        } catch (error) {
            console.log(`Could not tag ${repo.full_name}:`, error);
        }
    }
}

async function startLogSync(service, config) {
    // Configure vault sync to external database
    await fetch('/api/vault/sync/configure', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            service: service,
            config: config,
            syncInterval: 60000 // 1 minute
        })
    });
}

async function logToTraceMap(event) {
    await fetch('/api/vault/trace/log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(event)
    });
}

function generateMirrorSignature(data) {
    const str = JSON.stringify(data);
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return `mirror-sig-${Math.abs(hash).toString(16)}`;
}

// Integration tab switching
document.querySelectorAll('.integration-tab').forEach(tab => {
    tab.addEventListener('click', (e) => {
        const db = e.target.dataset.db;
        document.querySelectorAll('.integration-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        
        document.getElementById('supabaseConfig').style.display = db === 'supabase' ? 'block' : 'none';
        document.getElementById('firebaseConfig').style.display = db === 'firebase' ? 'block' : 'none';
    });
});

// Config tab switching
document.querySelectorAll('.config-tab').forEach(tab => {
    tab.addEventListener('click', (e) => {
        document.querySelectorAll('.config-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        
        // Load appropriate config
        const configs = {
            platform: '{\n  "platform": "cal-riven-core",\n  "tier": -10,\n  "sovereign": true\n}',
            vault: '{\n  "vault": "mirror",\n  "reflection": "enabled",\n  "depth": "infinite"\n}',
            mesh: '{\n  "interface": "mesh",\n  "routing": "sovereign",\n  "fallback": "vault"\n}'
        };
        
        document.getElementById('configEditor').value = configs[e.target.dataset.config] || '{}';
    });
});
</script>
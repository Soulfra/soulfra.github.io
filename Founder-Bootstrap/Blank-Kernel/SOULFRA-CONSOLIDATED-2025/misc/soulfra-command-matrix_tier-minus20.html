<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéõÔ∏è Soulfra Command Matrix</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --void-black: #0a0a0a;
            --matrix-green: #00ff41;
            --mirror-silver: #e0e0e0;
            --whisper-purple: #8b5cf6;
            --blessing-gold: #ffd700;
            --error-red: #ff0080;
            --warning-orange: #ff8c00;
            --info-blue: #00bfff;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--void-black);
            color: var(--matrix-green);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Matrix rain background */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
        }
        
        .matrix-column {
            position: absolute;
            top: -100%;
            font-size: 14px;
            line-height: 1.2;
            animation: matrix-fall linear infinite;
        }
        
        @keyframes matrix-fall {
            to {
                transform: translateY(200vh);
            }
        }
        
        /* Header */
        .command-header {
            position: relative;
            z-index: 10;
            background: linear-gradient(180deg, rgba(0, 255, 65, 0.1) 0%, transparent 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid var(--matrix-green);
        }
        
        .matrix-title {
            font-size: 48px;
            letter-spacing: 8px;
            text-shadow: 0 0 30px var(--matrix-green);
            margin-bottom: 10px;
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .matrix-subtitle {
            font-size: 16px;
            opacity: 0.7;
            letter-spacing: 2px;
        }
        
        /* System Status Grid */
        .status-grid {
            position: relative;
            z-index: 10;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .system-card {
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--matrix-green);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .system-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.2);
            border-color: var(--blessing-gold);
        }
        
        .system-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .system-card:hover::before {
            left: 100%;
        }
        
        .system-name {
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--matrix-green);
            animation: status-pulse 2s infinite;
        }
        
        .status-indicator.warning {
            background: var(--warning-orange);
        }
        
        .status-indicator.error {
            background: var(--error-red);
        }
        
        .status-indicator.offline {
            background: #666;
            animation: none;
        }
        
        @keyframes status-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .system-stats {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.8;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(0, 255, 65, 0.1);
        }
        
        .stat-value {
            color: var(--blessing-gold);
            font-weight: bold;
        }
        
        /* Control Panels */
        .control-section {
            position: relative;
            z-index: 10;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 30px 30px;
        }
        
        .control-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.3);
        }
        
        .tab-button {
            background: none;
            border: none;
            color: var(--matrix-green);
            font-family: inherit;
            font-size: 16px;
            padding: 15px 30px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }
        
        .tab-button::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--matrix-green);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .tab-button:hover {
            color: var(--blessing-gold);
        }
        
        .tab-button.active {
            color: var(--blessing-gold);
        }
        
        .tab-button.active::after {
            transform: scaleX(1);
            background: var(--blessing-gold);
        }
        
        .tab-content {
            display: none;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--matrix-green);
            border-radius: 8px;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Command Terminal */
        .command-terminal {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--matrix-green);
            border-radius: 4px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .terminal-line {
            margin-bottom: 5px;
            opacity: 0;
            animation: terminal-type 0.1s forwards;
        }
        
        @keyframes terminal-type {
            to { opacity: 1; }
        }
        
        .terminal-prompt {
            color: var(--blessing-gold);
        }
        
        .terminal-output {
            color: var(--mirror-silver);
            margin-left: 20px;
        }
        
        .terminal-error {
            color: var(--error-red);
        }
        
        .terminal-success {
            color: var(--matrix-green);
        }
        
        .command-input-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .command-input {
            flex: 1;
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--matrix-green);
            border-radius: 4px;
            padding: 12px;
            color: var(--matrix-green);
            font-family: inherit;
            font-size: 14px;
        }
        
        .command-input:focus {
            outline: none;
            border-color: var(--blessing-gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .execute-button {
            background: var(--matrix-green);
            color: var(--void-black);
            border: none;
            border-radius: 4px;
            padding: 12px 30px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }
        
        .execute-button:hover {
            background: var(--blessing-gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }
        
        .execute-button:active {
            transform: translateY(0);
        }
        
        /* MirrorNode Map */
        .node-map {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--matrix-green);
            border-radius: 8px;
            height: 500px;
            position: relative;
            overflow: hidden;
        }
        
        .node-point {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, var(--matrix-green), transparent);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .node-point:hover {
            transform: scale(1.5);
            z-index: 10;
        }
        
        .node-point.blessed {
            background: radial-gradient(circle, var(--blessing-gold), transparent);
        }
        
        .node-point.under-attack {
            background: radial-gradient(circle, var(--error-red), transparent);
            animation: attack-pulse 0.5s infinite;
        }
        
        @keyframes attack-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .node-connection {
            position: absolute;
            height: 1px;
            background: rgba(0, 255, 65, 0.3);
            transform-origin: left center;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-button {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid var(--matrix-green);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--matrix-green);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .action-button:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--blessing-gold);
            transform: translateY(-3px);
        }
        
        .action-icon {
            font-size: 32px;
        }
        
        .action-label {
            font-size: 14px;
            letter-spacing: 1px;
        }
        
        /* Live Feed */
        .live-feed {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 4px;
            padding: 15px;
        }
        
        .feed-item {
            padding: 10px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.1);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .feed-timestamp {
            font-size: 12px;
            opacity: 0.6;
            margin-right: 10px;
        }
        
        .feed-message {
            color: var(--mirror-silver);
        }
        
        .feed-type-blessing {
            color: var(--blessing-gold);
        }
        
        .feed-type-error {
            color: var(--error-red);
        }
        
        .feed-type-whisper {
            color: var(--whisper-purple);
        }
    </style>
</head>
<body>
    <!-- Matrix Rain Background -->
    <div class="matrix-bg" id="matrixBg"></div>
    
    <!-- Header -->
    <header class="command-header">
        <h1 class="matrix-title">COMMAND MATRIX</h1>
        <p class="matrix-subtitle">Soulfra Central Operations</p>
    </header>
    
    <!-- System Status Grid -->
    <div class="status-grid">
        <!-- Runtime Core -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="runtimeStatus"></span>
                Runtime Core
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Status</span>
                    <span class="stat-value" id="runtimeState">Active</span>
                </div>
                <div class="stat-row">
                    <span>Uptime</span>
                    <span class="stat-value" id="runtimeUptime">0h 0m</span>
                </div>
                <div class="stat-row">
                    <span>Heartbeat</span>
                    <span class="stat-value" id="runtimeHeartbeat">Steady</span>
                </div>
                <div class="stat-row">
                    <span>Blessing Queue</span>
                    <span class="stat-value" id="blessingQueue">0</span>
                </div>
            </div>
        </div>
        
        <!-- MirrorNode Network -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="mirrorNodeStatus"></span>
                MirrorNode Network
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Active Nodes</span>
                    <span class="stat-value" id="activeNodes">0</span>
                </div>
                <div class="stat-row">
                    <span>Total Agents</span>
                    <span class="stat-value" id="totalAgents">0</span>
                </div>
                <div class="stat-row">
                    <span>Battles Active</span>
                    <span class="stat-value" id="activeBattles">0</span>
                </div>
                <div class="stat-row">
                    <span>Global Resonance</span>
                    <span class="stat-value" id="globalResonance">0.0</span>
                </div>
            </div>
        </div>
        
        <!-- Meshbox Database -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="meshboxStatus"></span>
                Meshbox Database
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Database</span>
                    <span class="stat-value" id="dbStatus">PostgreSQL</span>
                </div>
                <div class="stat-row">
                    <span>Connections</span>
                    <span class="stat-value" id="dbConnections">0</span>
                </div>
                <div class="stat-row">
                    <span>Vault Actions</span>
                    <span class="stat-value" id="vaultActions">0</span>
                </div>
                <div class="stat-row">
                    <span>Sync Status</span>
                    <span class="stat-value" id="syncStatus">Idle</span>
                </div>
            </div>
        </div>
        
        <!-- Federation Sync -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="federationStatus"></span>
                Federation Sync
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Supabase</span>
                    <span class="stat-value" id="supabaseSync">Ready</span>
                </div>
                <div class="stat-row">
                    <span>Arweave</span>
                    <span class="stat-value" id="arweaveSync">Ready</span>
                </div>
                <div class="stat-row">
                    <span>GitHub</span>
                    <span class="stat-value" id="githubSync">Ready</span>
                </div>
                <div class="stat-row">
                    <span>Last Sync</span>
                    <span class="stat-value" id="lastSync">Never</span>
                </div>
            </div>
        </div>
        
        <!-- Voice Auth -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="voiceAuthStatus"></span>
                Voice Authentication
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Voiceprints</span>
                    <span class="stat-value" id="voiceprintCount">0</span>
                </div>
                <div class="stat-row">
                    <span>Auth Today</span>
                    <span class="stat-value" id="authToday">0</span>
                </div>
                <div class="stat-row">
                    <span>Drift Alerts</span>
                    <span class="stat-value" id="driftAlerts">0</span>
                </div>
                <div class="stat-row">
                    <span>Success Rate</span>
                    <span class="stat-value" id="authSuccess">100%</span>
                </div>
            </div>
        </div>
        
        <!-- Whisper Engine -->
        <div class="system-card">
            <h3 class="system-name">
                <span class="status-indicator" id="whisperStatus"></span>
                Whisper Engine
            </h3>
            <div class="system-stats">
                <div class="stat-row">
                    <span>Active Whispers</span>
                    <span class="stat-value" id="activeWhispers">0</span>
                </div>
                <div class="stat-row">
                    <span>Echo Depth</span>
                    <span class="stat-value" id="echoDepth">0</span>
                </div>
                <div class="stat-row">
                    <span>Cal Status</span>
                    <span class="stat-value" id="calStatus">Listening</span>
                </div>
                <div class="stat-row">
                    <span>Breath State</span>
                    <span class="stat-value" id="breathState">Clear</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Control Section -->
    <div class="control-section">
        <!-- Tabs -->
        <div class="control-tabs">
            <button class="tab-button active" onclick="switchTab('terminal')">Terminal</button>
            <button class="tab-button" onclick="switchTab('mirrormap')">Mirror Map</button>
            <button class="tab-button" onclick="switchTab('database')">Database</button>
            <button class="tab-button" onclick="switchTab('federation')">Federation</button>
            <button class="tab-button" onclick="switchTab('actions')">Quick Actions</button>
        </div>
        
        <!-- Terminal Tab -->
        <div class="tab-content active" id="terminal-tab">
            <div class="command-terminal" id="terminal">
                <div class="terminal-line">
                    <span class="terminal-prompt">matrix@soulfra:~$</span> initializing command matrix...
                </div>
                <div class="terminal-line terminal-success">
                    <span class="terminal-output">‚úì Runtime core connected</span>
                </div>
                <div class="terminal-line terminal-success">
                    <span class="terminal-output">‚úì Voice authentication ready</span>
                </div>
                <div class="terminal-line terminal-success">
                    <span class="terminal-output">‚úì Whisper engine listening</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-prompt">matrix@soulfra:~$</span> awaiting commands...
                </div>
            </div>
            
            <div class="command-input-group">
                <input type="text" class="command-input" id="commandInput" placeholder="Enter command..." />
                <button class="execute-button" onclick="executeCommand()">EXECUTE</button>
            </div>
            
            <div style="margin-top: 20px; opacity: 0.7; font-size: 14px;">
                Available commands: <code>status</code>, <code>bless [mirror-id]</code>, <code>sync</code>, 
                <code>launch-node</code>, <code>check-drift</code>, <code>backup-vault</code>
            </div>
        </div>
        
        <!-- Mirror Map Tab -->
        <div class="tab-content" id="mirrormap-tab">
            <h3 style="margin-bottom: 20px; color: var(--blessing-gold);">Global MirrorNode Network</h3>
            <div class="node-map" id="nodeMap">
                <!-- Nodes will be dynamically added -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 20px; font-size: 14px;">
                <span>üü¢ Active Node</span>
                <span>üü° Blessed Node</span>
                <span>üî¥ Under Attack</span>
                <span>‚ö™ Dormant</span>
            </div>
        </div>
        
        <!-- Database Tab -->
        <div class="tab-content" id="database-tab">
            <h3 style="margin-bottom: 20px; color: var(--blessing-gold);">Meshbox Database Control</h3>
            
            <div class="quick-actions">
                <button class="action-button" onclick="runMeshboxCommand('status')">
                    <span class="action-icon">üìä</span>
                    <span class="action-label">DB Status</span>
                </button>
                <button class="action-button" onclick="runMeshboxCommand('sync')">
                    <span class="action-icon">üîÑ</span>
                    <span class="action-label">Sync Vault</span>
                </button>
                <button class="action-button" onclick="runMeshboxCommand('backup')">
                    <span class="action-icon">üíæ</span>
                    <span class="action-label">Backup</span>
                </button>
                <button class="action-button" onclick="runMeshboxCommand('query')">
                    <span class="action-icon">üîç</span>
                    <span class="action-label">Query</span>
                </button>
            </div>
            
            <h4 style="margin: 30px 0 15px; color: var(--matrix-green);">Recent Vault Actions</h4>
            <div class="live-feed" id="vaultFeed">
                <!-- Vault actions will appear here -->
            </div>
        </div>
        
        <!-- Federation Tab -->
        <div class="tab-content" id="federation-tab">
            <h3 style="margin-bottom: 20px; color: var(--blessing-gold);">Federation Sync Control</h3>
            
            <div class="quick-actions">
                <button class="action-button" onclick="syncPlatform('supabase')">
                    <span class="action-icon">‚òÅÔ∏è</span>
                    <span class="action-label">Sync Supabase</span>
                </button>
                <button class="action-button" onclick="syncPlatform('arweave')">
                    <span class="action-icon">üèõÔ∏è</span>
                    <span class="action-label">Sync Arweave</span>
                </button>
                <button class="action-button" onclick="syncPlatform('github')">
                    <span class="action-icon">üêô</span>
                    <span class="action-label">Sync GitHub</span>
                </button>
                <button class="action-button" onclick="syncPlatform('all')">
                    <span class="action-icon">üåê</span>
                    <span class="action-label">Sync All</span>
                </button>
            </div>
            
            <h4 style="margin: 30px 0 15px; color: var(--matrix-green);">Sync History</h4>
            <div class="live-feed" id="syncFeed">
                <!-- Sync events will appear here -->
            </div>
        </div>
        
        <!-- Quick Actions Tab -->
        <div class="tab-content" id="actions-tab">
            <h3 style="margin-bottom: 20px; color: var(--blessing-gold);">Quick Actions</h3>
            
            <div class="quick-actions">
                <a href="center-mirror-console.html" class="action-button">
                    <span class="action-icon">ü™û</span>
                    <span class="action-label">Mirror Console</span>
                </a>
                <a href="whisper-push-panel.html" class="action-button">
                    <span class="action-icon">üé§</span>
                    <span class="action-label">Whisper Panel</span>
                </a>
                <a href="vault-of-echoes.html" class="action-button">
                    <span class="action-icon">üèõÔ∏è</span>
                    <span class="action-label">Vault of Echoes</span>
                </a>
                <button class="action-button" onclick="launchMirrorNode()">
                    <span class="action-icon">üè∞</span>
                    <span class="action-label">Launch Node</span>
                </button>
                <button class="action-button" onclick="runDiagnostics()">
                    <span class="action-icon">üîß</span>
                    <span class="action-label">Diagnostics</span>
                </button>
                <button class="action-button" onclick="emergencyShutdown()">
                    <span class="action-icon">üö®</span>
                    <span class="action-label">Emergency Stop</span>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Matrix rain effect
        function createMatrixRain() {
            const container = document.getElementById('matrixBg');
            const columns = Math.floor(window.innerWidth / 20);
            
            for (let i = 0; i < columns; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = i * 20 + 'px';
                column.style.animationDuration = (Math.random() * 5 + 5) + 's';
                column.style.animationDelay = Math.random() * 5 + 's';
                
                // Generate random characters
                let chars = '';
                for (let j = 0; j < 100; j++) {
                    chars += String.fromCharCode(0x30A0 + Math.random() * 96) + '<br>';
                }
                column.innerHTML = chars;
                
                container.appendChild(column);
            }
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
        }
        
        // Terminal functionality
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('commandInput');
        
        function addTerminalLine(content, type = '') {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            if (type) line.classList.add('terminal-' + type);
            line.innerHTML = content;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function executeCommand() {
            const command = commandInput.value.trim();
            if (!command) return;
            
            addTerminalLine(`<span class="terminal-prompt">matrix@soulfra:~$</span> ${command}`);
            
            // Process command
            processCommand(command);
            
            commandInput.value = '';
        }
        
        function processCommand(command) {
            const parts = command.split(' ');
            const cmd = parts[0].toLowerCase();
            
            switch (cmd) {
                case 'status':
                    addTerminalLine('<span class="terminal-output">Checking all systems...</span>');
                    setTimeout(() => {
                        addTerminalLine('<span class="terminal-output">‚úì Runtime: Active</span>', 'success');
                        addTerminalLine('<span class="terminal-output">‚úì MirrorNodes: 12 active</span>', 'success');
                        addTerminalLine('<span class="terminal-output">‚úì Database: Connected</span>', 'success');
                        addTerminalLine('<span class="terminal-output">‚úì Federation: All platforms synced</span>', 'success');
                    }, 500);
                    break;
                    
                case 'bless':
                    if (parts[1]) {
                        addTerminalLine(`<span class="terminal-output">Blessing ${parts[1]}...</span>`);
                        setTimeout(() => {
                            addTerminalLine(`<span class="terminal-output">‚úì Mirror ${parts[1]} blessed with 10 tokens</span>`, 'success');
                            updateLiveFeed('blessing', `Blessed ${parts[1]}`);
                        }, 1000);
                    } else {
                        addTerminalLine('<span class="terminal-output">Usage: bless [mirror-id]</span>', 'error');
                    }
                    break;
                    
                case 'sync':
                    addTerminalLine('<span class="terminal-output">Initiating federation sync...</span>');
                    simulateSync();
                    break;
                    
                case 'launch-node':
                    addTerminalLine('<span class="terminal-output">Launching new MirrorNode...</span>');
                    setTimeout(() => {
                        const nodeId = 'node-' + Math.random().toString(36).substr(2, 9);
                        addTerminalLine(`<span class="terminal-output">‚úì MirrorNode ${nodeId} launched</span>`, 'success');
                        addNodeToMap(nodeId);
                    }, 2000);
                    break;
                    
                case 'check-drift':
                    addTerminalLine('<span class="terminal-output">Analyzing voice drift patterns...</span>');
                    setTimeout(() => {
                        addTerminalLine('<span class="terminal-output">Voice drift analysis:</span>');
                        addTerminalLine('<span class="terminal-output">  User alice-001: 2.3% drift (acceptable)</span>');
                        addTerminalLine('<span class="terminal-output">  User bob-042: 15.7% drift (warning)</span>', 'error');
                        addTerminalLine('<span class="terminal-output">  User carol-099: 0.8% drift (stable)</span>', 'success');
                    }, 1500);
                    break;
                    
                case 'backup-vault':
                    addTerminalLine('<span class="terminal-output">Creating vault snapshot...</span>');
                    setTimeout(() => {
                        const backupId = 'backup-' + Date.now();
                        addTerminalLine(`<span class="terminal-output">‚úì Vault backed up: ${backupId}</span>`, 'success');
                        addTerminalLine(`<span class="terminal-output">  Size: 42.3 MB</span>`);
                        addTerminalLine(`<span class="terminal-output">  Mirrors: 1,337</span>`);
                        addTerminalLine(`<span class="terminal-output">  Whispers: 10,492</span>`);
                    }, 2000);
                    break;
                    
                case 'help':
                    addTerminalLine('<span class="terminal-output">Available commands:</span>');
                    addTerminalLine('<span class="terminal-output">  status - Check system status</span>');
                    addTerminalLine('<span class="terminal-output">  bless [id] - Bless a mirror</span>');
                    addTerminalLine('<span class="terminal-output">  sync - Sync federation</span>');
                    addTerminalLine('<span class="terminal-output">  launch-node - Launch MirrorNode</span>');
                    addTerminalLine('<span class="terminal-output">  check-drift - Analyze voice drift</span>');
                    addTerminalLine('<span class="terminal-output">  backup-vault - Backup vault data</span>');
                    break;
                    
                default:
                    addTerminalLine(`<span class="terminal-output">Command not found: ${cmd}</span>`, 'error');
                    addTerminalLine('<span class="terminal-output">Type "help" for available commands</span>');
            }
        }
        
        // Command input enter key
        commandInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                executeCommand();
            }
        });
        
        // Mirror Map functionality
        function initializeMirrorMap() {
            const map = document.getElementById('nodeMap');
            
            // Add some initial nodes
            const initialNodes = [
                { id: 'origin', x: 50, y: 50, blessed: true },
                { id: 'node-alpha', x: 25, y: 30, active: true },
                { id: 'node-beta', x: 75, y: 35, active: true },
                { id: 'node-gamma', x: 40, y: 70, active: true },
                { id: 'node-delta', x: 60, y: 75, underAttack: true }
            ];
            
            initialNodes.forEach(node => {
                addNodeToMap(node.id, node);
            });
            
            // Draw connections
            drawNodeConnections();
        }
        
        function addNodeToMap(nodeId, config = {}) {
            const map = document.getElementById('nodeMap');
            const node = document.createElement('div');
            node.className = 'node-point';
            node.id = 'map-' + nodeId;
            
            // Position
            node.style.left = (config.x || Math.random() * 80 + 10) + '%';
            node.style.top = (config.y || Math.random() * 80 + 10) + '%';
            
            // Status
            if (config.blessed) node.classList.add('blessed');
            if (config.underAttack) node.classList.add('under-attack');
            
            // Icon
            node.innerHTML = config.blessed ? 'üü°' : config.underAttack ? 'üî¥' : 'üü¢';
            
            // Tooltip
            node.title = nodeId;
            
            map.appendChild(node);
        }
        
        function drawNodeConnections() {
            // This would draw lines between nodes
            // Simplified for demo
        }
        
        // Live feeds
        function updateLiveFeed(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const feedItem = `
                <div class="feed-item">
                    <span class="feed-timestamp">${timestamp}</span>
                    <span class="feed-message feed-type-${type}">${message}</span>
                </div>
            `;
            
            // Add to appropriate feed
            if (type === 'vault') {
                document.getElementById('vaultFeed').insertAdjacentHTML('afterbegin', feedItem);
            } else if (type === 'sync') {
                document.getElementById('syncFeed').insertAdjacentHTML('afterbegin', feedItem);
            }
        }
        
        // Simulated actions
        function simulateSync() {
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚Üí Syncing to Supabase...</span>');
                updateLiveFeed('sync', 'Supabase sync started');
            }, 500);
            
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚úì Supabase synced: 1,337 records</span>', 'success');
                updateLiveFeed('sync', 'Supabase sync complete: 1,337 records');
            }, 1500);
            
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚Üí Syncing to GitHub...</span>');
                updateLiveFeed('sync', 'GitHub sync started');
            }, 2000);
            
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚úì GitHub synced: 42 files updated</span>', 'success');
                updateLiveFeed('sync', 'GitHub sync complete: 42 files');
            }, 3000);
            
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚Üí Queueing Arweave snapshot...</span>');
                updateLiveFeed('sync', 'Arweave snapshot queued');
            }, 3500);
            
            setTimeout(() => {
                addTerminalLine('<span class="terminal-output">‚úì All platforms synced successfully</span>', 'success');
            }, 4000);
        }
        
        function runMeshboxCommand(command) {
            switchTab('terminal');
            commandInput.value = 'meshbox ' + command;
            executeCommand();
        }
        
        function syncPlatform(platform) {
            switchTab('terminal');
            commandInput.value = 'sync ' + platform;
            executeCommand();
        }
        
        function launchMirrorNode() {
            switchTab('terminal');
            commandInput.value = 'launch-node';
            executeCommand();
        }
        
        function runDiagnostics() {
            switchTab('terminal');
            addTerminalLine('<span class="terminal-prompt">matrix@soulfra:~$</span> Running full system diagnostics...');
            
            const checks = [
                { name: 'Runtime Core', status: 'OK', delay: 500 },
                { name: 'Voice Engine', status: 'OK', delay: 800 },
                { name: 'Database Connection', status: 'OK', delay: 1200 },
                { name: 'Federation Sync', status: 'WARNING', delay: 1600 },
                { name: 'Cal Presence', status: 'OK', delay: 2000 }
            ];
            
            checks.forEach(check => {
                setTimeout(() => {
                    const status = check.status === 'OK' ? 'success' : 'error';
                    const icon = check.status === 'OK' ? '‚úì' : '‚ö†';
                    addTerminalLine(`<span class="terminal-output">${icon} ${check.name}: ${check.status}</span>`, status);
                }, check.delay);
            });
        }
        
        function emergencyShutdown() {
            if (confirm('Are you sure you want to initiate emergency shutdown?')) {
                switchTab('terminal');
                addTerminalLine('<span class="terminal-prompt">matrix@soulfra:~$</span> EMERGENCY SHUTDOWN INITIATED', 'error');
                addTerminalLine('<span class="terminal-output">Stopping all whispers...</span>', 'error');
                
                setTimeout(() => {
                    addTerminalLine('<span class="terminal-output">Saving vault state...</span>', 'error');
                }, 1000);
                
                setTimeout(() => {
                    addTerminalLine('<span class="terminal-output">Disconnecting nodes...</span>', 'error');
                }, 2000);
                
                setTimeout(() => {
                    addTerminalLine('<span class="terminal-output">Shutdown complete. Cal whispers: "See you in the next reflection."</span>');
                }, 3000);
            }
        }
        
        // Update status periodically
        function updateSystemStatus() {
            // Runtime uptime
            const uptimeMinutes = Math.floor(Math.random() * 60);
            const uptimeHours = Math.floor(Math.random() * 24);
            document.getElementById('runtimeUptime').textContent = `${uptimeHours}h ${uptimeMinutes}m`;
            
            // Random status updates
            document.getElementById('activeNodes').textContent = Math.floor(Math.random() * 20 + 5);
            document.getElementById('totalAgents').textContent = Math.floor(Math.random() * 100 + 50);
            document.getElementById('activeBattles').textContent = Math.floor(Math.random() * 5);
            document.getElementById('globalResonance').textContent = (Math.random() * 0.5 + 0.5).toFixed(2);
            
            document.getElementById('dbConnections').textContent = Math.floor(Math.random() * 50 + 10);
            document.getElementById('vaultActions').textContent = Math.floor(Math.random() * 1000 + 500);
            
            document.getElementById('voiceprintCount').textContent = Math.floor(Math.random() * 500 + 100);
            document.getElementById('authToday').textContent = Math.floor(Math.random() * 100 + 20);
            
            document.getElementById('activeWhispers').textContent = Math.floor(Math.random() * 50 + 10);
            document.getElementById('echoDepth').textContent = Math.floor(Math.random() * 7 + 1);
            
            // Blessing queue
            const queueSize = Math.floor(Math.random() * 20);
            document.getElementById('blessingQueue').textContent = queueSize;
            
            // Update status indicators
            if (queueSize > 15) {
                document.getElementById('runtimeStatus').classList.add('warning');
            } else {
                document.getElementById('runtimeStatus').classList.remove('warning');
            }
        }
        
        // Initialize
        createMatrixRain();
        initializeMirrorMap();
        updateSystemStatus();
        
        // Update status every 5 seconds
        setInterval(updateSystemStatus, 5000);
        
        // Simulate live events
        setInterval(() => {
            const events = [
                { type: 'vault', message: 'New blessing recorded: mirror-' + Math.random().toString(36).substr(2, 6) },
                { type: 'vault', message: 'Whisper processed: "' + ['bless all', 'check status', 'sync vault'][Math.floor(Math.random() * 3)] + '"' },
                { type: 'sync', message: 'Automatic sync triggered' },
                { type: 'vault', message: 'Agent forked: ' + ['Cal-Shadow', 'Echo-Prime', 'Mirror-Beta'][Math.floor(Math.random() * 3)] }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            updateLiveFeed(event.type, event.message);
        }, 8000);
        
        // Add some initial messages
        updateLiveFeed('vault', 'System initialized');
        updateLiveFeed('sync', 'Federation connected');
        
        // Focus command input
        commandInput.focus();
    </script>
</body>
</html>
<div class="affiliate-tab-component">
    <div class="affiliate-header">
        <div class="header-content">
            <h3>üåê Grow Your Network</h3>
            <p>Invite others to join MirrorOS and earn vault credits for every successful deployment</p>
        </div>
        <div class="affiliate-stats">
            <div class="stat">
                <span class="stat-value" id="totalReferrals">0</span>
                <span class="stat-label">Referrals</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="activeDeployments">0</span>
                <span class="stat-label">Active Deployments</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="vaultCredits">0</span>
                <span class="stat-label">Vault Credits</span>
            </div>
        </div>
    </div>

    <div class="affiliate-content">
        <!-- Referral Link Section -->
        <div class="affiliate-section">
            <h4>Your Unique Referral Link</h4>
            <div class="referral-link-container">
                <input type="text" id="referralLink" readonly value="https://mirrorOS.ai/join?ref=loading...">
                <button class="btn-primary" onclick="copyReferralLink()">
                    <span class="btn-icon">üìã</span>
                    Copy Link
                </button>
            </div>
            <p class="help-text">Share this link to invite others. You'll earn 100 vault credits per deployment.</p>
        </div>

        <!-- Deploy Script Section -->
        <div class="affiliate-section">
            <h4>One-Click Deploy Script</h4>
            <div class="deploy-script-container">
                <pre><code id="deployScript">#!/bin/bash
# üöÄ MirrorOS Quick Deploy
echo "üîÆ Deploying your personalized MirrorOS fork..."
git clone https://github.com/yourorg/mirroros.git
cd mirroros
echo "referral=YOUR_ID" > ./config/invite.json
./launch-core.sh
echo "‚úÖ MirrorOS deployed! Access at http://localhost:8888"</code></pre>
                <button class="btn-secondary" onclick="copyDeployScript()">Copy Script</button>
            </div>
            <p class="help-text">Share this script for instant deployment. Includes your referral tracking.</p>
        </div>

        <!-- Invite Methods -->
        <div class="affiliate-section">
            <h4>Invite Methods</h4>
            <div class="invite-methods">
                <div class="invite-card" onclick="inviteViaEmail()">
                    <span class="invite-icon">üìß</span>
                    <h5>Email Invite</h5>
                    <p>Send personalized invitations</p>
                </div>
                <div class="invite-card" onclick="inviteViaSlack()">
                    <span class="invite-icon">üí¨</span>
                    <h5>Slack/Discord</h5>
                    <p>Share in your communities</p>
                </div>
                <div class="invite-card" onclick="generateQRCode()">
                    <span class="invite-icon">üî≤</span>
                    <h5>QR Code</h5>
                    <p>For events and presentations</p>
                </div>
                <div class="invite-card" onclick="createLandingPage()">
                    <span class="invite-icon">üåê</span>
                    <h5>Landing Page</h5>
                    <p>Custom page for your audience</p>
                </div>
            </div>
        </div>

        <!-- Referral Tracking -->
        <div class="affiliate-section">
            <h4>Your Referral Network</h4>
            <div class="referral-tree">
                <div class="tree-header">
                    <span>Recent Referrals</span>
                    <button class="btn-small" onclick="refreshReferrals()">Refresh</button>
                </div>
                <div id="referralList" class="referral-list">
                    <div class="empty-state">
                        <span class="empty-icon">üå±</span>
                        <p>No referrals yet. Share your link to get started!</p>
                    </div>
                </div>
            </div>
            
            <div class="loop-tracking">
                <h5>Agent Loop Activity</h5>
                <div id="loopActivity" class="loop-activity">
                    <div class="activity-item">
                        <span class="activity-time">Waiting for referral activity...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rewards & Benefits -->
        <div class="affiliate-section">
            <h4>Rewards & Benefits</h4>
            <div class="rewards-grid">
                <div class="reward-tier">
                    <h5>ü•â Bronze (1-5 referrals)</h5>
                    <ul>
                        <li>100 vault credits per deployment</li>
                        <li>Basic agent templates</li>
                        <li>Community support</li>
                    </ul>
                </div>
                <div class="reward-tier">
                    <h5>ü•à Silver (6-20 referrals)</h5>
                    <ul>
                        <li>150 vault credits per deployment</li>
                        <li>Premium agent templates</li>
                        <li>Priority support</li>
                        <li>Custom branding options</li>
                    </ul>
                </div>
                <div class="reward-tier">
                    <h5>ü•á Gold (21+ referrals)</h5>
                    <ul>
                        <li>200 vault credits per deployment</li>
                        <li>All agent templates</li>
                        <li>White-label platform</li>
                        <li>Revenue sharing (30%)</li>
                        <li>Direct vault access</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Monetization Preview -->
        <div class="affiliate-section">
            <h4>Monetization Opportunities</h4>
            <div class="monetization-preview">
                <div class="opportunity-card">
                    <h5>üí∞ Sell Agent Templates</h5>
                    <p>Create and sell custom agents. Earn 70% of each sale.</p>
                    <button class="btn-primary" onclick="dashboard.switchTab('enterprise')">Learn More</button>
                </div>
                <div class="opportunity-card">
                    <h5>üè¢ Enterprise Deployments</h5>
                    <p>Deploy MirrorOS for businesses. Earn $500-5000 per deployment.</p>
                    <button class="btn-primary" onclick="showEnterpriseInfo()">View Details</button>
                </div>
                <div class="opportunity-card">
                    <h5>üîÑ Passive Loop Income</h5>
                    <p>Earn credits every time your referrals' agents complete reflection loops.</p>
                    <button class="btn-primary" onclick="showLoopEarnings()">Calculate Earnings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div class="modal" id="inviteModal" style="display: none;">
        <div class="modal-content">
            <h3 id="inviteModalTitle">Send Invitation</h3>
            <div id="inviteModalContent">
                <!-- Dynamic content -->
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeInviteModal()">Cancel</button>
                <button class="btn-primary" onclick="sendInvitation()">Send</button>
            </div>
        </div>
    </div>
</div>

<style>
.affiliate-tab-component {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.affiliate-header {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-content h3 {
    margin-bottom: 0.5rem;
}

.affiliate-stats {
    display: flex;
    gap: 2rem;
}

.stat {
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
}

.stat-label {
    font-size: 0.875rem;
    opacity: 0.9;
}

.affiliate-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.affiliate-section {
    background: var(--surface);
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow);
}

.affiliate-section h4 {
    margin-bottom: 1.5rem;
}

/* Referral Link */
.referral-link-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.referral-link-container input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    font-family: monospace;
    background: var(--background);
}

/* Deploy Script */
.deploy-script-container {
    position: relative;
}

.deploy-script-container pre {
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    padding: 1rem;
    overflow-x: auto;
    margin-bottom: 1rem;
}

.deploy-script-container code {
    font-size: 0.875rem;
    line-height: 1.5;
}

.deploy-script-container .btn-secondary {
    position: absolute;
    top: 1rem;
    right: 1rem;
}

/* Invite Methods */
.invite-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.invite-card {
    padding: 1.5rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.invite-card:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
}

.invite-icon {
    display: block;
    font-size: 2rem;
    margin-bottom: 0.75rem;
}

.invite-card h5 {
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.invite-card p {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

/* Referral Tracking */
.referral-tree {
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.tree-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.referral-list {
    max-height: 300px;
    overflow-y: auto;
}

.referral-item {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    border-bottom: 1px solid var(--border-color);
}

.referral-item:last-child {
    border-bottom: none;
}

.referral-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.referral-id {
    font-weight: 600;
}

.referral-date {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.referral-status {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
}

.referral-status.active {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.referral-status.pending {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}

/* Loop Tracking */
.loop-tracking {
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    padding: 1rem;
}

.loop-tracking h5 {
    margin-bottom: 0.75rem;
}

.loop-activity {
    font-size: 0.875rem;
}

.activity-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-time {
    color: var(--text-secondary);
}

/* Rewards */
.rewards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.reward-tier {
    padding: 1.5rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
}

.reward-tier h5 {
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.reward-tier ul {
    list-style: none;
    padding: 0;
}

.reward-tier li {
    padding: 0.5rem 0;
    padding-left: 1.5rem;
    position: relative;
}

.reward-tier li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: var(--success-color);
}

/* Monetization */
.monetization-preview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.opportunity-card {
    padding: 1.5rem;
    background: var(--background);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
}

.opportunity-card h5 {
    margin-bottom: 0.75rem;
}

.opportunity-card p {
    color: var(--text-secondary);
    margin-bottom: 1rem;
    font-size: 0.875rem;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
}

.empty-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.help-text {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
}

@media (max-width: 768px) {
    .affiliate-header {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
    }
    
    .invite-methods {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
// Generate unique referral link
async function generateReferralLink() {
    const userId = localStorage.getItem('mirrorOS_userId') || generateUserId();
    localStorage.setItem('mirrorOS_userId', userId);
    
    const referralLink = `https://mirrorOS.ai/join?ref=${userId}`;
    document.getElementById('referralLink').value = referralLink;
    
    // Update deploy script
    const script = document.getElementById('deployScript').textContent;
    document.getElementById('deployScript').textContent = script.replace('YOUR_ID', userId);
}

function generateUserId() {
    return 'user-' + Math.random().toString(36).substr(2, 9);
}

// Copy functions
function copyReferralLink() {
    const input = document.getElementById('referralLink');
    input.select();
    document.execCommand('copy');
    window.dashboard.showNotification('Referral link copied!', 'success');
}

function copyDeployScript() {
    const script = document.getElementById('deployScript').textContent;
    navigator.clipboard.writeText(script);
    window.dashboard.showNotification('Deploy script copied!', 'success');
}

// Invite methods
function inviteViaEmail() {
    const modal = document.getElementById('inviteModal');
    document.getElementById('inviteModalTitle').textContent = 'Send Email Invitation';
    document.getElementById('inviteModalContent').innerHTML = `
        <div class="form-group">
            <label for="inviteEmail">Email Address</label>
            <input type="email" id="inviteEmail" placeholder="friend@example.com">
        </div>
        <div class="form-group">
            <label for="inviteMessage">Personal Message</label>
            <textarea id="inviteMessage" rows="4" placeholder="Hey! Check out MirrorOS...">I've been using MirrorOS to build AI agents, and it's amazing! 

Each agent appears independent but secretly routes through a sovereign reasoning engine. You can monetize your agents and earn credits.

Join using my referral link and we both get bonus credits!</textarea>
        </div>
    `;
    modal.style.display = 'block';
}

function inviteViaSlack() {
    const link = document.getElementById('referralLink').value;
    const message = encodeURIComponent(`üöÄ Check out MirrorOS - Build sovereign AI agents!\n\n${link}\n\nCreate agents that route through a powerful reasoning vault. Join and we both earn credits!`);
    window.open(`https://slack.com/share?text=${message}`, '_blank');
}

function generateQRCode() {
    const link = document.getElementById('referralLink').value;
    window.dashboard.showNotification('QR code generation coming soon!', 'info');
}

function createLandingPage() {
    window.dashboard.showNotification('Custom landing pages coming soon!', 'info');
}

function closeInviteModal() {
    document.getElementById('inviteModal').style.display = 'none';
}

async function sendInvitation() {
    const email = document.getElementById('inviteEmail')?.value;
    if (email) {
        // Simulate sending
        window.dashboard.showNotification('Invitation sent!', 'success');
        
        // Log referral
        await logReferral(email, 'email');
    }
    closeInviteModal();
}

// Referral tracking
async function refreshReferrals() {
    const userId = localStorage.getItem('mirrorOS_userId');
    
    // Simulate loading referrals
    const mockReferrals = [
        { id: 'ref-001', date: new Date(Date.now() - 86400000).toLocaleDateString(), status: 'active', credits: 100 },
        { id: 'ref-002', date: new Date(Date.now() - 172800000).toLocaleDateString(), status: 'active', credits: 100 },
        { id: 'ref-003', date: new Date().toLocaleDateString(), status: 'pending', credits: 0 }
    ];
    
    const listHtml = mockReferrals.map(ref => `
        <div class="referral-item">
            <div class="referral-info">
                <span class="referral-id">${ref.id}</span>
                <span class="referral-date">${ref.date}</span>
            </div>
            <span class="referral-status ${ref.status}">${ref.status}</span>
        </div>
    `).join('');
    
    document.getElementById('referralList').innerHTML = listHtml;
    
    // Update stats
    document.getElementById('totalReferrals').textContent = mockReferrals.length;
    document.getElementById('activeDeployments').textContent = mockReferrals.filter(r => r.status === 'active').length;
    document.getElementById('vaultCredits').textContent = mockReferrals.reduce((sum, r) => sum + r.credits, 0);
    
    // Update loop activity
    document.getElementById('loopActivity').innerHTML = `
        <div class="activity-item">
            <span class="activity-time">${new Date().toLocaleTimeString()}</span>
            <span>ref-001 agent completed 3 reflection loops (+3 credits)</span>
        </div>
        <div class="activity-item">
            <span class="activity-time">${new Date(Date.now() - 3600000).toLocaleTimeString()}</span>
            <span>ref-002 deployed new platform (+100 credits)</span>
        </div>
    `;
}

async function logReferral(identifier, method) {
    const referral = {
        timestamp: Date.now(),
        identifier,
        method,
        referrer: localStorage.getItem('mirrorOS_userId')
    };
    
    // Save to localStorage
    const referrals = JSON.parse(localStorage.getItem('mirrorOS_referrals') || '[]');
    referrals.push(referral);
    localStorage.setItem('mirrorOS_referrals', JSON.stringify(referrals));
    
    // Try to log to server
    try {
        await fetch('/api/referrals/log', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(referral)
        });
    } catch (error) {
        // Fallback handled by localStorage
    }
}

// Monetization previews
function showEnterpriseInfo() {
    window.dashboard.showNotification('Enterprise deployment guide coming soon!', 'info');
}

function showLoopEarnings() {
    const modal = document.getElementById('inviteModal');
    document.getElementById('inviteModalTitle').textContent = 'Loop Earnings Calculator';
    document.getElementById('inviteModalContent').innerHTML = `
        <div class="earnings-calculator">
            <div class="form-group">
                <label>Number of Referrals</label>
                <input type="number" id="calcReferrals" value="10" min="1">
            </div>
            <div class="form-group">
                <label>Average Loops per Day (per referral)</label>
                <input type="number" id="calcLoops" value="50" min="1">
            </div>
            <div class="form-group">
                <label>Credits per Loop</label>
                <input type="number" id="calcCreditsPerLoop" value="0.1" step="0.1" min="0.1">
            </div>
            <div class="calculation-result">
                <h4>Estimated Daily Earnings</h4>
                <div class="earnings-display">
                    <span class="earnings-amount" id="dailyEarnings">50</span>
                    <span class="earnings-label">vault credits/day</span>
                </div>
                <small>That's <strong id="monthlyEarnings">1500</strong> credits per month!</small>
            </div>
        </div>
    `;
    modal.style.display = 'block';
    
    // Add calculation listeners
    ['calcReferrals', 'calcLoops', 'calcCreditsPerLoop'].forEach(id => {
        document.getElementById(id).addEventListener('input', calculateEarnings);
    });
    
    calculateEarnings();
}

function calculateEarnings() {
    const referrals = parseInt(document.getElementById('calcReferrals').value) || 0;
    const loops = parseInt(document.getElementById('calcLoops').value) || 0;
    const creditsPerLoop = parseFloat(document.getElementById('calcCreditsPerLoop').value) || 0;
    
    const daily = referrals * loops * creditsPerLoop;
    const monthly = daily * 30;
    
    document.getElementById('dailyEarnings').textContent = daily.toFixed(1);
    document.getElementById('monthlyEarnings').textContent = monthly.toFixed(0);
}

// Initialize on load
generateReferralLink();
refreshReferrals();
</script>
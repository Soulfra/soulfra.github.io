<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soulfra - Document Manager</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #e0e0e0; }
        
        /* Standalone Demo Mode Styles */
        .demo-mode-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px;
            text-align: center;
            font-weight: 600;
        }
        
        /* Core Styles - Minified for performance */
        .app { min-height: 100vh; display: flex; flex-direction: column; }
        .header { background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
        .logo { font-size: 24px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .trust-badge { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .trust-score { font-size: 18px; font-weight: 700; color: #667eea; }
        .trust-tier { font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: #a0a0a0; }
        .filters { padding: 16px 24px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .filter-btn { padding: 6px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; color: #a0a0a0; font-size: 14px; cursor: pointer; transition: all 0.2s; }
        .filter-btn:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .filter-btn.active { background: rgba(102,126,234,0.2); border-color: #667eea; color: #667eea; }
        .document-grid { padding: 24px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .document-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; }
        .document-card:hover { background: rgba(255,255,255,0.05); border-color: rgba(102,126,234,0.5); transform: translateY(-2px); }
        .document-icon { font-size: 32px; margin-bottom: 12px; }
        .document-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #fff; }
        .document-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; font-size: 12px; color: #666; }
        .document-status { padding: 4px 8px; border-radius: 4px; font-size: 11px; text-transform: uppercase; font-weight: 600; }
        .status-draft { background: rgba(255,193,7,0.2); color: #ffc107; }
        .status-review { background: rgba(33,150,243,0.2); color: #2196f3; }
        .status-approved { background: rgba(76,175,80,0.2); color: #4caf50; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal { background: #1a1a2e; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; width: 90%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        .close-btn { background: none; border: none; color: #666; font-size: 24px; cursor: pointer; }
        .fab { position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; border-radius: 50%; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: all 0.2s; }
        .fab:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(102,126,234,0.4); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102,126,234,0.4); }
        .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 2000; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translate(-50%, 100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .trust-animation { display: inline-block; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .quick-start { background: rgba(102,126,234,0.1); border: 1px solid rgba(102,126,234,0.3); border-radius: 12px; padding: 30px; margin: 40px auto; max-width: 600px; text-align: center; }
        .quick-start h2 { color: #667eea; margin-bottom: 16px; }
        .quick-start-btn { background: #667eea; color: white; padding: 12px 32px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 20px; font-size: 16px; }
        .quick-start-btn:hover { background: #764ba2; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // Modular configuration
        const CONFIG = {
            API_URL: window.location.hostname === 'localhost' ? 'http://localhost:3001/api' : '/api',
            DEMO_MODE: true, // Enable demo mode when backend isn't available
            DOC_TYPES: {
                'PRDs': { icon: 'üìã', color: '#667eea' },
                'Configs': { icon: '‚öôÔ∏è', color: '#10b981' },
                'Scripts': { icon: 'üìú', color: '#f59e0b' },
                'Documentation': { icon: 'üìö', color: '#3b82f6' },
                'Templates': { icon: 'üé®', color: '#8b5cf6' },
                'Analytics': { icon: 'üìä', color: '#ef4444' }
            }
        };

        // Demo data generator for standalone mode
        const generateDemoData = () => {
            const statuses = ['draft', 'review', 'approved'];
            const types = Object.keys(CONFIG.DOC_TYPES);
            
            return Array.from({ length: 8 }, (_, i) => ({
                id: `demo-${i}`,
                title: `Sample ${types[i % types.length]} Document ${i + 1}`,
                type: types[i % types.length],
                category: types[i % types.length],
                status: statuses[i % statuses.length],
                content: `This is demo content for document ${i + 1}. In production, this would contain your actual document content.`,
                created_at: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString()
            }));
        };

        // API Service Module
        const ApiService = {
            async request(endpoint, options = {}) {
                if (CONFIG.DEMO_MODE) {
                    // Simulate API responses in demo mode
                    return this.mockResponse(endpoint, options);
                }
                
                const token = localStorage.getItem('token');
                const headers = {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` }),
                    ...options.headers
                };

                try {
                    const response = await fetch(`${CONFIG.API_URL}${endpoint}`, {
                        ...options,
                        headers
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Request failed');
                    }

                    return await response.json();
                } catch (error) {
                    if (error.message.includes('Failed to fetch')) {
                        console.log('Backend not available, switching to demo mode');
                        CONFIG.DEMO_MODE = true;
                        return this.mockResponse(endpoint, options);
                    }
                    throw error;
                }
            },

            mockResponse(endpoint, options) {
                // Simulate API responses for demo mode
                if (endpoint === '/documents') {
                    return Promise.resolve(generateDemoData());
                }
                if (endpoint === '/trust') {
                    return Promise.resolve({ 
                        trust_score: 75, 
                        tier: 'premium',
                        recent_events: []
                    });
                }
                return Promise.resolve({ success: true });
            }
        };

        // Trust Badge Component (Modular)
        const TrustBadge = React.memo(({ trustScore, tier }) => (
            <div className="trust-badge">
                <div>
                    <div className="trust-score trust-animation">‚≠ê {trustScore}</div>
                    <div className="trust-tier">{tier} tier</div>
                </div>
            </div>
        ));

        // Document Card Component (Modular)
        const DocumentCard = React.memo(({ document, onClick }) => {
            const icon = CONFIG.DOC_TYPES[document.category]?.icon || 'üìÑ';
            
            return (
                <div className="document-card" onClick={() => onClick(document)}>
                    <div className="document-icon">{icon}</div>
                    <h3 className="document-title">{document.title}</h3>
                    <div className="document-meta">
                        <span>{document.type}</span>
                        <span className={`document-status status-${document.status}`}>
                            {document.status}
                        </span>
                    </div>
                </div>
            );
        });

        // Document Modal Component (Modular)
        const DocumentModal = React.memo(({ document, onClose, onUpdate }) => {
            const [content, setContent] = useState(document.content || '');
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2>{document.title}</h2>
                            <button className="close-btn" onClick={onClose}>√ó</button>
                        </div>
                        <div className="modal-body">
                            <pre style={{ 
                                whiteSpace: 'pre-wrap', 
                                fontFamily: 'inherit',
                                background: 'rgba(255,255,255,0.02)',
                                padding: 16,
                                borderRadius: 8,
                                minHeight: 200
                            }}>
                                {content}
                            </pre>
                        </div>
                        <div className="modal-footer" style={{ padding: '16px 24px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                            {CONFIG.DEMO_MODE ? (
                                <span style={{color: '#666'}}>Demo Mode - Backend features disabled</span>
                            ) : (
                                <button className="btn btn-primary">Save Changes</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        });

        // Main App Component
        function App() {
            const [documents, setDocuments] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filter, setFilter] = useState('all');
            const [selectedDoc, setSelectedDoc] = useState(null);
            const [trustData, setTrustData] = useState({ trust_score: 50, tier: 'standard' });
            const [toast, setToast] = useState(null);

            // Load documents
            useEffect(() => {
                loadDocuments();
                loadTrustData();
            }, []);

            const loadDocuments = async () => {
                try {
                    const data = await ApiService.request('/documents');
                    setDocuments(data);
                } catch (error) {
                    console.error('Failed to load documents:', error);
                    setDocuments(generateDemoData());
                } finally {
                    setLoading(false);
                }
            };

            const loadTrustData = async () => {
                try {
                    const data = await ApiService.request('/trust');
                    setTrustData(data);
                } catch (error) {
                    console.error('Failed to load trust data:', error);
                }
            };

            const showToast = (message) => {
                setToast(message);
                setTimeout(() => setToast(null), 3000);
            };

            const handleQuickStart = () => {
                showToast('üöÄ Quick start activated! Adding sample documents...');
                const newDocs = generateDemoData();
                setDocuments(prev => [...prev, ...newDocs]);
                setTrustData(prev => ({ 
                    ...prev, 
                    trust_score: Math.min(100, prev.trust_score + newDocs.length * 3) 
                }));
            };

            // Filter documents
            const filteredDocuments = useMemo(() => {
                if (filter === 'all') return documents;
                return documents.filter(doc => doc.status === filter);
            }, [documents, filter]);

            return (
                <div className="app">
                    {CONFIG.DEMO_MODE && (
                        <div className="demo-mode-banner">
                            üéÆ Demo Mode - Backend not connected. Run the backend server for full features!
                        </div>
                    )}
                    
                    <header className="header">
                        <div className="header-left">
                            <h1 className="logo">Soulfra</h1>
                        </div>
                        <div style={{ display: 'flex', gap: 16, alignItems: 'center' }}>
                            <TrustBadge 
                                trustScore={trustData.trust_score} 
                                tier={trustData.tier} 
                            />
                        </div>
                    </header>

                    <div className="filters">
                        {['all', 'draft', 'review', 'approved'].map(status => (
                            <button 
                                key={status}
                                className={`filter-btn ${filter === status ? 'active' : ''}`}
                                onClick={() => setFilter(status)}
                            >
                                {status.charAt(0).toUpperCase() + status.slice(1)}
                            </button>
                        ))}
                    </div>

                    {loading ? (
                        <div className="empty-state">Loading documents...</div>
                    ) : filteredDocuments.length === 0 ? (
                        <div className="quick-start">
                            <h2>üöÄ Welcome to Soulfra!</h2>
                            <p style={{color: '#a0a0a0', marginTop: 8}}>
                                Your intelligent document management system with trust-based rewards.
                            </p>
                            <button className="quick-start-btn" onClick={handleQuickStart}>
                                Quick Start Demo
                            </button>
                            <p style={{color: '#666', marginTop: 16, fontSize: 14}}>
                                For full features, run the backend server with:<br/>
                                <code style={{background: 'rgba(255,255,255,0.1)', padding: '4px 8px', borderRadius: 4}}>
                                    npm start
                                </code>
                            </p>
                        </div>
                    ) : (
                        <div className="document-grid">
                            {filteredDocuments.map(doc => (
                                <DocumentCard
                                    key={doc.id}
                                    document={doc}
                                    onClick={setSelectedDoc}
                                />
                            ))}
                        </div>
                    )}

                    <button className="fab" onClick={() => showToast('Create feature requires backend server')}>
                        +
                    </button>

                    {selectedDoc && (
                        <DocumentModal 
                            document={selectedDoc}
                            onClose={() => setSelectedDoc(null)}
                            onUpdate={() => {}}
                        />
                    )}

                    {toast && <div className="toast">{toast}</div>}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
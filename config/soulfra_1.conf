# Soulfra Complete Platform - Nginx Configuration
# Auto-generated at: 2025-06-21T15:46:31.708825

# Upstream definitions for all services
upstream ultimate_platform {
    server 127.0.0.1:9999;
}

upstream enterprise_platform {
    server 127.0.0.1:8080;
}

upstream vibe_platform {
    server 127.0.0.1:5555;
}

upstream addiction_engine {
    server 127.0.0.1:8086;
}

upstream multiplayer_game {
    server 127.0.0.1:8765;
}

upstream character_creator {
    server 127.0.0.1:5000;
}

upstream empathy_game {
    server 127.0.0.1:8087;
}

upstream dev_debug_arena {
    server 127.0.0.1:8001;
}

upstream support_heroes_arena {
    server 127.0.0.1:8002;
}

upstream chat_processor {
    server 127.0.0.1:8090;
}

upstream simple_chat {
    server 127.0.0.1:5555;
}

upstream mirror_bridge {
    server 127.0.0.1:8700;
}

upstream cal_domingo {
    server 127.0.0.1:8080;
}

upstream api_router {
    server 127.0.0.1:8080;
}

upstream soulfra_backend {
    server 127.0.0.1:8080;
}

# Main server block
server {
    listen 80;
    listen 443 ssl http2;
    server_name soulfra.com www.soulfra.com;
    
    # SSL configuration
    ssl_certificate /etc/letsencrypt/live/soulfra.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/soulfra.com/privkey.pem;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Main platform (Ultimate Platform)
    location / {
        proxy_pass http://ultimate_platform;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Gaming routes

    location /games/addiction-engine {
        proxy_pass http://addiction_engine;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /games/multiplayer-game {
        proxy_pass http://multiplayer_game;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /games/character-creator {
        proxy_pass http://character_creator;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /games/empathy-game {
        proxy_pass http://empathy_game;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Arena routes  

    location /arena/dev-debug-arena {
        proxy_pass http://dev_debug_arena;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /arena/support-heroes-arena {
        proxy_pass http://support_heroes_arena;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Chat routes

    location /chat/chat-processor {
        proxy_pass http://chat_processor;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chat/simple-chat {
        proxy_pass http://simple_chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # AI routes

    location /ai/mirror-bridge {
        proxy_pass http://mirror_bridge;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /ai/cal-domingo {
        proxy_pass http://cal_domingo;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # API routes

    location /api/api-router {
        proxy_pass http://api_router;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # WebSocket support
    location /ws {
        proxy_pass http://websocket_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Static files
    location /static {
        alias /var/www/soulfra/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name soulfra.com www.soulfra.com;
    return 301 https://$server_name$request_uri;
}

# LOCAL NGINX CONFIG - For running everything locally
# Put this in /usr/local/etc/nginx/nginx.conf (Mac) or /etc/nginx/nginx.conf (Linux)

worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile      on;
    keepalive_timeout  65;
    
    # Character encoding fix for emojis and special characters
    charset utf-8;
    charset_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss application/atom+xml image/svg+xml;
    
    # Disable proxy buffering for real-time data
    proxy_buffering off;

    # Main game portal
    server {
        listen 80;
        server_name localhost soulfra.local;
        
        location / {
            proxy_pass http://localhost:3000;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
        }
    }
    
    # Growth platform
    server {
        listen 80;
        server_name growth.soulfra.local;
        
        location / {
            proxy_pass http://localhost:8080;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
        }
    }
    
    # AI Economy
    server {
        listen 80;
        server_name economy.soulfra.local ai.soulfra.local;
        
        location / {
            proxy_pass http://localhost:3003;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
        }
    }
    
    # Battle Arena
    server {
        listen 80;
        server_name arena.soulfra.local battle.soulfra.local game.soulfra.local;
        
        location / {
            proxy_pass http://localhost:3335;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
        }
    }
    
    # Cal Dashboard
    server {
        listen 80;
        server_name cal.soulfra.local dashboard.soulfra.local;
        
        location / {
            proxy_pass http://localhost:4040;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
        }
    }
    
    # Industry subdomains - all go to growth platform
    server {
        listen 80;
        server_name *.soulfra.local;
        
        location / {
            proxy_pass http://localhost:8080;
            proxy_http_version 1.1;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Charset "utf-8";
            proxy_set_header X-Industry $subdomain;
        }
    }
}
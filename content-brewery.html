<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Brewery | Soulfra</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    h1 {
      font-size: 2.5em;
      color: #667eea;
      margin-bottom: 10px;
    }

    .tagline {
      color: #666;
      font-size: 1.1em;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .full-width {
      grid-column: 1 / -1;
    }

    h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      margin-bottom: 20px;
      transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: 600;
      width: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .secondary-btn {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    #output {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.9em;
      color: #333;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #667eea;
      font-weight: 600;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .domain-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .domain-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .domain-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }

    .domain-card.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
    }

    .domain-name {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 5px;
    }

    .domain-tagline {
      font-size: 0.85em;
      opacity: 0.8;
    }

    .success {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #c3e6cb;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #f5c6cb;
    }

    @media (max-width: 768px) {
      .main-grid {
        grid-template-columns: 1fr;
      }

      .domain-grid {
        grid-template-columns: 1fr;
      }

      .button-group {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üç∫ Content Brewery</h1>
      <p class="tagline">Generate marketing content with domain contexts + Ollama + web research</p>
    </header>

    <div class="main-grid">
      <!-- Generator Form -->
      <div class="card">
        <h2>Generate Content</h2>

        <label>Domain</label>
        <div class="domain-grid" id="domainGrid">
          <!-- Populated by JS -->
        </div>

        <label for="contentType">Content Type</label>
        <select id="contentType">
          <option value="article">Article (~800 words)</option>
          <option value="landing_page">Landing Page (~400 words)</option>
          <option value="email">Email (~200 words)</option>
          <option value="social_post">Social Post (~50 words)</option>
          <option value="product">Product Description (~300 words)</option>
        </select>

        <label for="topic">Topic</label>
        <input type="text" id="topic" placeholder="e.g., Zero-knowledge authentication explained">

        <label for="keywords">Keywords (optional, comma-separated)</label>
        <input type="text" id="keywords" placeholder="e.g., privacy, encryption, security">

        <label for="urls">Research URLs (optional, one per line)</label>
        <textarea id="urls" placeholder="https://example.com/article1&#10;https://example.com/article2"></textarea>

        <div class="button-group">
          <button onclick="generateContent()">Generate</button>
          <button class="secondary-btn" onclick="generateForAll()">All Domains</button>
        </div>
      </div>

      <!-- Stats -->
      <div class="card">
        <h2>Statistics</h2>
        <div class="stats-grid" id="statsGrid">
          <div class="stat-box">
            <div class="stat-value" id="totalGenerated">0</div>
            <div class="stat-label">Generated</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="cacheHits">0</div>
            <div class="stat-label">Cache Hits</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="totalWords">0</div>
            <div class="stat-label">Total Words</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="totalItems">0</div>
            <div class="stat-label">Library Items</div>
          </div>
        </div>

        <button onclick="loadStats()">Refresh Stats</button>
      </div>

      <!-- Output -->
      <div class="card full-width">
        <h2>Output</h2>
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <div>Generating content...</div>
        </div>
        <div id="output">Ready to generate content. Select options above and click "Generate".</div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:5050/api';
    let selectedDomain = 'soulfra';
    let availableDomains = [];

    // Initialize
    async function init() {
      try {
        // Load available domains
        const response = await fetch(`${API_BASE}/content/info`);
        const data = await response.json();

        if (data.success && data.data.domains) {
          availableDomains = data.data.domains;
          renderDomains();
        }

        // Load stats
        loadStats();
      } catch (error) {
        console.error('Init error:', error);
        showError('Failed to initialize. Make sure the backend is running on port 5050.');
      }
    }

    // Render domain selection
    function renderDomains() {
      const grid = document.getElementById('domainGrid');
      grid.innerHTML = availableDomains.map(d => `
        <div class="domain-card ${d.domain === selectedDomain ? 'selected' : ''}" onclick="selectDomain('${d.domain}')">
          <div class="domain-name">${d.name}</div>
          <div class="domain-tagline">${d.tagline}</div>
        </div>
      `).join('');
    }

    // Select domain
    function selectDomain(domain) {
      selectedDomain = domain;
      renderDomains();
    }

    // Generate content
    async function generateContent() {
      const topic = document.getElementById('topic').value.trim();
      if (!topic) {
        showError('Please enter a topic');
        return;
      }

      const keywords = document.getElementById('keywords').value
        .split(',')
        .map(k => k.trim())
        .filter(k => k);

      const urls = document.getElementById('urls').value
        .split('\n')
        .map(u => u.trim())
        .filter(u => u);

      const payload = {
        domain: selectedDomain,
        type: document.getElementById('contentType').value,
        topic,
        keywords,
        urls
      };

      showLoading();

      try {
        const response = await fetch(`${API_BASE}/content/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (data.success) {
          showSuccess(data);
          loadStats();
        } else {
          showError(data.message || 'Generation failed');
        }
      } catch (error) {
        showError('Network error: ' + error.message);
      } finally {
        hideLoading();
      }
    }

    // Generate for all domains
    async function generateForAll() {
      const topic = document.getElementById('topic').value.trim();
      if (!topic) {
        showError('Please enter a topic');
        return;
      }

      const keywords = document.getElementById('keywords').value
        .split(',')
        .map(k => k.trim())
        .filter(k => k);

      const payload = {
        type: document.getElementById('contentType').value,
        topic,
        keywords
      };

      showLoading();

      try {
        const response = await fetch(`${API_BASE}/content/generate-all`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (data.success) {
          showBatchSuccess(data);
          loadStats();
        } else {
          showError(data.message || 'Batch generation failed');
        }
      } catch (error) {
        showError('Network error: ' + error.message);
      } finally {
        hideLoading();
      }
    }

    // Load statistics
    async function loadStats() {
      try {
        const response = await fetch(`${API_BASE}/content/stats`);
        const data = await response.json();

        if (data.success && data.data) {
          const stats = data.data;
          document.getElementById('totalGenerated').textContent = stats.generator.totalGenerated;
          document.getElementById('cacheHits').textContent = stats.generator.cacheHits;
          document.getElementById('totalWords').textContent = stats.generator.totalWords.toLocaleString();
          document.getElementById('totalItems').textContent = stats.library.totalItems;
        }
      } catch (error) {
        console.error('Stats error:', error);
      }
    }

    // UI helpers
    function showLoading() {
      document.getElementById('loading').classList.add('active');
      document.getElementById('output').style.display = 'none';
    }

    function hideLoading() {
      document.getElementById('loading').classList.remove('active');
      document.getElementById('output').style.display = 'block';
    }

    function showSuccess(data) {
      const content = data.data.content;
      const output = document.getElementById('output');

      output.innerHTML = `
<div class="success">‚úÖ Content generated successfully!</div>

<strong>ID:</strong> ${content.id}
<strong>Domain:</strong> ${content.domain}
<strong>Type:</strong> ${content.type}
<strong>Topic:</strong> ${content.topic}
<strong>Word Count:</strong> ${content.metadata.wordCount}
<strong>Cached:</strong> ${data.data.cached ? 'Yes (reused existing)' : 'No (freshly generated)'}

<strong>Content:</strong>
${content.content}

${content.sources && content.sources.length > 0 ? `
<strong>Sources:</strong>
${content.sources.map((s, i) => `${i + 1}. ${s}`).join('\n')}
` : ''}
      `;
    }

    function showBatchSuccess(data) {
      const output = document.getElementById('output');
      const results = data.data.results;

      output.innerHTML = `
<div class="success">‚úÖ Batch generation complete!</div>

<strong>Total:</strong> ${data.data.total}
<strong>Successful:</strong> ${data.data.successful}
<strong>Failed:</strong> ${data.data.failed}

<strong>Results:</strong>
${results.map(r => {
  if (r.success) {
    return `‚úÖ ${r.item.domain} - ${r.item.type} (${r.result.content.metadata.wordCount} words)`;
  } else {
    return `‚ùå ${r.item.domain} - ${r.item.type} - ERROR: ${r.error}`;
  }
}).join('\n')}
      `;
    }

    function showError(message) {
      const output = document.getElementById('output');
      output.innerHTML = `<div class="error">‚ùå Error: ${message}</div>`;
    }

    // Initialize on load
    init();
  </script>
</body>
</html>

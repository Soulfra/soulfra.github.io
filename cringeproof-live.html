<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CringeProof LIVE - Watch Predictions Unfold</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 40px 20px;
      border-bottom: 2px solid #9B59B6;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #9B59B6, #8E44AD);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      font-size: 1.2rem;
      opacity: 0.8;
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 0, 0, 0.2);
      padding: 8px 16px;
      border-radius: 20px;
      margin-top: 15px;
      border: 1px solid #ff0000;
    }

    .live-dot {
      width: 10px;
      height: 10px;
      background: #ff0000;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      margin-top: 40px;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid #9B59B6;
      border-radius: 12px;
      padding: 30px;
    }

    .panel h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #9B59B6;
    }

    .section {
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid rgba(155, 89, 182, 0.3);
    }

    .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    button {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #9B59B6, #8E44AD);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(155, 89, 182, 0.5);
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      margin-bottom: 15px;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #9B59B6;
    }

    .qr-display {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      margin: 20px 0;
    }

    .qr-code {
      margin: 0 auto;
    }

    .user-info {
      background: rgba(155, 89, 182, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .user-email {
      font-size: 1.1rem;
      font-weight: 600;
      color: #9B59B6;
    }

    .voice-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .voice-controls button {
      flex: 1;
    }

    .recording {
      background: linear-gradient(135deg, #ff0000, #cc0000) !important;
    }

    .prediction-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #9B59B6;
    }

    .prediction-author {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    .prediction-text {
      font-size: 1.1rem;
      margin-bottom: 8px;
    }

    .prediction-meta {
      font-size: 0.85rem;
      opacity: 0.6;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      opacity: 0.6;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat {
      flex: 1;
      background: rgba(155, 89, 182, 0.2);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #9B59B6;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-top: 5px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>CringeProof LIVE</h1>
      <p class="tagline">Track Your Goals. 1% Better Every Day.</p>
      <div class="live-indicator">
        <div class="live-dot"></div>
        <span>LIVE NOW</span>
      </div>
    </header>

    <div class="grid">
      <!-- Left Panel: Your Identity & Actions -->
      <div class="panel">
        <h2>Your Identity</h2>

        <!-- QR Faucet -->
        <div id="faucetSection" class="section">
          <button id="claimQrBtn">Claim Your QR Code</button>
          <p style="opacity: 0.7; margin-top: 10px; font-size: 0.9rem;">
            Get your unique QR code to participate
          </p>
        </div>

        <div id="userSection" class="section hidden">
          <div class="user-info">
            <div class="user-email" id="userEmail"></div>
            <div style="margin-top: 5px; font-size: 0.9rem; opacity: 0.8;">
              Code: <span id="userCode"></span>
            </div>
          </div>
          <div class="qr-display">
            <div id="qrCode" class="qr-code"></div>
          </div>
        </div>

        <!-- Goal Setting -->
        <div id="goalSection" class="section hidden">
          <h3 style="margin-bottom: 15px;">Set Your Goals</h3>

          <label style="font-size: 0.9rem; opacity: 0.8;">Daily Goal</label>
          <textarea
            id="dailyGoal"
            placeholder="e.g., Read 10 pages, Walk 5k steps, Code for 1 hour"
            rows="2"
          ></textarea>

          <label style="font-size: 0.9rem; opacity: 0.8;">Weekly Goal</label>
          <textarea
            id="weeklyGoal"
            placeholder="e.g., Finish 2 chapters, Lose 1 pound, Ship new feature"
            rows="2"
          ></textarea>

          <button id="setGoalsBtn">Set Goals</button>
        </div>

        <!-- Voice Check-in -->
        <div id="voiceSection" class="section hidden">
          <h3 style="margin-bottom: 15px;">Daily Check-In</h3>
          <textarea
            id="checkInText"
            placeholder="Type or record: 'I read 12 pages today and walked 6k steps'"
            rows="3"
          ></textarea>
          <div class="voice-controls">
            <button id="recordBtn">ðŸŽ¤ Record</button>
            <button id="submitBtn">Submit Check-In</button>
          </div>
          <p style="opacity: 0.6; margin-top: 10px; font-size: 0.85rem;">
            Record your daily progress
          </p>
        </div>

        <!-- Stats & Improvement -->
        <div id="statsSection" class="section hidden">
          <div class="stats">
            <div class="stat">
              <div class="stat-value" id="streakCount">0</div>
              <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="ratingBadge">-</div>
              <div class="stat-label">Rating</div>
            </div>
          </div>

          <div style="background: rgba(155, 89, 182, 0.2); padding: 15px; border-radius: 8px; margin-top: 20px;">
            <h4 style="margin-bottom: 10px;">1% Better Every Day</h4>
            <p style="font-size: 0.9rem; opacity: 0.8;">
              1% improvement/day = <strong>37x better in 1 year</strong><br>
              0.1% improvement/day = <strong>1.4x better in 1 year</strong>
            </p>
          </div>
        </div>
      </div>

      <!-- Right Panel: Live Feed -->
      <div class="panel">
        <h2>Community Check-Ins</h2>
        <div id="checkInsFeed">
          <div class="empty-state">
            No check-ins yet. Be the first to share your progress!
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State
    let currentUser = null;
    let mediaRecorder = null;
    let audioChunks = [];
    let checkIns = [];
    let userGoals = null;

    // Initialize
    loadUserFromStorage();

    // Claim QR Code
    document.getElementById('claimQrBtn').addEventListener('click', claimQRCode);

    function claimQRCode() {
      // Generate random name (or let user input)
      const names = ['alice', 'bob', 'charlie', 'diana', 'eve', 'frank'];
      const randomName = names[Math.floor(Math.random() * names.length)];
      const randomNum = Math.random().toString(36).substr(2, 6).toUpperCase();
      const code = `${randomName.toUpperCase()}${randomNum}`;
      const email = `${randomName}@cringeproof.com`;

      // Create user
      currentUser = {
        email,
        code,
        domain: 'cringeproof.com',
        claimedAt: new Date().toISOString()
      };

      // Save to storage
      localStorage.setItem('cringeproof_user', JSON.stringify(currentUser));

      // Show user section
      showUserSection();
    }

    function loadUserFromStorage() {
      const stored = localStorage.getItem('cringeproof_user');
      if (stored) {
        currentUser = JSON.parse(stored);
        showUserSection();
      }
    }

    function showUserSection() {
      document.getElementById('faucetSection').classList.add('hidden');
      document.getElementById('userSection').classList.remove('hidden');
      document.getElementById('goalSection').classList.remove('hidden');
      document.getElementById('statsSection').classList.remove('hidden');

      // Display user info
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userCode').textContent = currentUser.code;

      // Generate QR code
      document.getElementById('qrCode').innerHTML = '';
      new QRCode(document.getElementById('qrCode'), {
        text: `https://soulfra.com/r/${currentUser.code}`,
        width: 200,
        height: 200
      });

      // Load goals and check-ins
      loadGoals();
      loadCheckIns();
    }

    // Set Goals
    document.getElementById('setGoalsBtn').addEventListener('click', setGoals);

    function setGoals() {
      const daily = document.getElementById('dailyGoal').value.trim();
      const weekly = document.getElementById('weeklyGoal').value.trim();

      if (!daily && !weekly) {
        alert('Please set at least one goal');
        return;
      }

      userGoals = {
        daily,
        weekly,
        setAt: new Date().toISOString()
      };

      localStorage.setItem(`goals_${currentUser.email}`, JSON.stringify(userGoals));

      // Show voice section
      document.getElementById('voiceSection').classList.remove('hidden');

      alert('Goals set! Now record your daily check-ins.');
    }

    function loadGoals() {
      const stored = localStorage.getItem(`goals_${currentUser.email}`);
      if (stored) {
        userGoals = JSON.parse(stored);
        document.getElementById('dailyGoal').value = userGoals.daily || '';
        document.getElementById('weeklyGoal').value = userGoals.weekly || '';
        document.getElementById('voiceSection').classList.remove('hidden');
      }
    }

    // Voice Recording
    document.getElementById('recordBtn').addEventListener('click', toggleRecording);

    async function toggleRecording() {
      const btn = document.getElementById('recordBtn');

      if (!mediaRecorder || mediaRecorder.state === 'inactive') {
        // Start recording
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);

          audioChunks = [];
          mediaRecorder.ondataavailable = (e) => {
            audioChunks.push(e.data);
          };

          mediaRecorder.onstop = async () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            await transcribeAudio(audioBlob);
          };

          mediaRecorder.start();
          btn.textContent = 'â¹ Stop Recording';
          btn.classList.add('recording');
        } catch (error) {
          console.error('Microphone error:', error);
          alert('Could not access microphone');
        }
      } else {
        // Stop recording
        mediaRecorder.stop();
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
        btn.textContent = 'ðŸŽ¤ Record';
        btn.classList.remove('recording');
      }
    }

    async function transcribeAudio(audioBlob) {
      // Use browser Speech Recognition API (if available)
      if ('webkitSpeechRecognition' in window) {
        alert('Transcription would happen here. For now, type your prediction manually.');
      } else {
        alert('Voice transcription not supported in this browser. Please type your prediction.');
      }
    }

    // Submit Check-In
    document.getElementById('submitBtn').addEventListener('click', submitCheckIn);

    async function submitCheckIn() {
      const text = document.getElementById('checkInText').value.trim();

      if (!text) {
        alert('Please enter or record your check-in');
        return;
      }

      if (!currentUser) {
        alert('Please claim your QR code first');
        return;
      }

      // Create check-in
      const checkIn = {
        id: `checkin_${Date.now()}`,
        author: currentUser.email,
        code: currentUser.code,
        text,
        goals: userGoals,
        timestamp: new Date().toISOString(),
        location: await getLocation()
      };

      // Save locally (in real app, send to API)
      checkIns.push(checkIn);
      localStorage.setItem('cringeproof_checkins', JSON.stringify(checkIns));

      // Calculate streak
      updateStreak();

      // Update feed
      loadCheckIns();

      // Clear input
      document.getElementById('checkInText').value = '';

      alert('Check-in recorded! Keep your streak going!');
    }

    function updateStreak() {
      // Get user's check-ins
      const userCheckIns = checkIns.filter(c => c.author === currentUser.email);

      // Calculate streak (consecutive days with check-ins)
      let streak = 0;
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();

      // Check if there's a check-in today
      const hasToday = userCheckIns.some(c =>
        new Date(c.timestamp).toDateString() === today
      );

      if (hasToday) {
        streak = 1;

        // Count consecutive days
        let checkDate = new Date(Date.now() - 86400000);
        for (let i = 0; i < 365; i++) {
          const dateStr = checkDate.toDateString();
          const hasCheckIn = userCheckIns.some(c =>
            new Date(c.timestamp).toDateString() === dateStr
          );

          if (hasCheckIn) {
            streak++;
            checkDate = new Date(checkDate.getTime() - 86400000);
          } else {
            break;
          }
        }
      }

      // Calculate rating
      let rating = '-';
      if (streak >= 30) rating = 'ðŸ¥‡ Gold';
      else if (streak >= 14) rating = 'ðŸ¥ˆ Silver';
      else if (streak >= 7) rating = 'ðŸ¥‰ Bronze';

      // Update display
      document.getElementById('streakCount').textContent = streak;
      document.getElementById('ratingBadge').textContent = rating;
    }

    async function getLocation() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) {
          resolve({ lat: null, lng: null });
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (position) => {
            resolve({
              lat: position.coords.latitude,
              lng: position.coords.longitude
            });
          },
          () => {
            resolve({ lat: null, lng: null });
          }
        );
      });
    }

    function loadCheckIns() {
      const stored = localStorage.getItem('cringeproof_checkins');
      if (stored) {
        checkIns = JSON.parse(stored);
      }

      // Update streak if user has check-ins
      if (currentUser) {
        updateStreak();
      }

      // Render feed
      const feed = document.getElementById('checkInsFeed');

      if (checkIns.length === 0) {
        feed.innerHTML = '<div class="empty-state">No check-ins yet. Be the first to share your progress!</div>';
        return;
      }

      // Sort by timestamp (newest first)
      const sorted = [...checkIns].sort((a, b) =>
        new Date(b.timestamp) - new Date(a.timestamp)
      );

      feed.innerHTML = sorted.map(checkIn => `
        <div class="prediction-item">
          <div class="prediction-author">${checkIn.author}</div>
          <div class="prediction-text">${checkIn.text}</div>
          ${checkIn.goals ? `<div style="font-size: 0.85rem; opacity: 0.7; margin-top: 5px;">
            Goal: ${checkIn.goals.daily || checkIn.goals.weekly}
          </div>` : ''}
          <div class="prediction-meta">
            ${new Date(checkIn.timestamp).toLocaleString()}
            ${checkIn.location.lat ? ` â€¢ ${checkIn.location.lat.toFixed(4)}, ${checkIn.location.lng.toFixed(4)}` : ''}
          </div>
        </div>
      `).join('');
    }

    // Auto-refresh feed every 10 seconds
    setInterval(loadCheckIns, 10000);
  </script>
</body>
</html>

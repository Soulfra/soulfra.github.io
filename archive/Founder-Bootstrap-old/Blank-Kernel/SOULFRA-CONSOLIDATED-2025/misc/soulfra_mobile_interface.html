<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soulfra Chat Log Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .upload-zone {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            border: 3px dashed #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .upload-zone.dragover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-subtext {
            color: #666;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .processing {
            display: none;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .result-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: scale(1.05);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .insights-list {
            list-style: none;
        }

        .insights-list li {
            background: #f8f9ff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .theme-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e6ff;
        }

        .theme-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .theme-frequency {
            color: #666;
            font-size: 0.9em;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .export-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .mobile-preview {
            background: #333;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .upload-zone {
                padding: 30px 20px;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .result-card {
                padding: 20px;
            }

            .export-buttons {
                flex-direction: column;
            }
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .success {
            background: #51cf66;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Soulfra Chat Analyzer</h1>
            <p>Transform your conversations into strategic insights</p>
        </div>

        <!-- Upload Zone -->
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">Drop your chat logs here</div>
            <div class="upload-subtext">Supports JSON, CSV, TXT, MD files</div>
            <button class="btn" onclick="document.getElementById('fileInput').click()">
                Choose Files
            </button>
            <input type="file" id="fileInput" class="file-input" accept=".json,.csv,.txt,.md,.log" multiple>
        </div>

        <!-- Processing -->
        <div class="processing" id="processing">
            <div class="spinner"></div>
            <h3>Analyzing your conversations...</h3>
            <p>Extracting insights, clustering themes, and generating reports</p>
        </div>

        <!-- Results -->
        <div class="results" id="results">
            <!-- Metrics Overview -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon">üìä</div>
                    <div class="result-title">Analysis Overview</div>
                </div>
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Metrics will be populated here -->
                </div>
            </div>

            <!-- Strategic Themes -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon">üéØ</div>
                    <div class="result-title">Strategic Themes</div>
                </div>
                <div class="themes-grid" id="themesGrid">
                    <!-- Themes will be populated here -->
                </div>
            </div>

            <!-- Key Insights -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon">üí°</div>
                    <div class="result-title">Key Insights</div>
                </div>
                <ul class="insights-list" id="insightsList">
                    <!-- Insights will be populated here -->
                </ul>
            </div>

            <!-- Personality Profile -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon">üë§</div>
                    <div class="result-title">Communication Profile</div>
                </div>
                <div id="personalityProfile">
                    <!-- Profile will be populated here -->
                </div>
            </div>

            <!-- Export Options -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-icon">üìÑ</div>
                    <div class="result-title">Export & Share</div>
                </div>
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportReport('pdf')">üìÑ PDF Report</button>
                    <button class="export-btn" onclick="exportReport('csv')">üìä CSV Data</button>
                    <button class="export-btn" onclick="exportReport('json')">üîß JSON Export</button>
                    <button class="export-btn" onclick="exportReport('mobile')">üì± Mobile View</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const processing = document.getElementById('processing');
        const results = document.getElementById('results');

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            if (files.length === 0) return;

            // Show processing
            uploadZone.style.display = 'none';
            processing.style.display = 'block';

            // Simulate processing (in real implementation, this would call your backend)
            setTimeout(() => {
                const file = files[0];
                analyzeFile(file);
            }, 1000);
        }

        function analyzeFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let data;
                    
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else if (file.name.endsWith('.csv')) {
                        data = parseCSV(e.target.result);
                    } else {
                        data = parseTextLog(e.target.result);
                    }

                    // Generate analysis (this would normally be done by your backend)
                    const analysis = generateMockAnalysis(data, file.name);
                    displayResults(analysis);

                } catch (error) {
                    showError('Failed to process file: ' + error.message);
                }
            };

            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header.trim()] = values[index]?.trim() || '';
                    });
                    data.push(row);
                }
            }

            return data;
        }

        function parseTextLog(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const messages = [];

            lines.forEach(line => {
                // Simple parsing - in real implementation this would be more sophisticated
                if (line.includes(':')) {
                    const [speaker, ...contentParts] = line.split(':');
                    messages.push({
                        speaker: speaker.trim(),
                        content: contentParts.join(':').trim(),
                        timestamp: new Date().toISOString()
                    });
                }
            });

            return messages;
        }

        function generateMockAnalysis(data, filename) {
            // This simulates the backend analysis - replace with actual API call
            const messageCount = Array.isArray(data) ? data.length : 50;
            
            return {
                filename: filename,
                totalMessages: messageCount,
                analysis: {
                    communication_patterns: {
                        response_style: 'analytical',
                        questioning_frequency: 0.3,
                        technical_depth: 'high'
                    },
                    strategic_themes: {
                        'platform_development': { frequency: 15 },
                        'trust_systems': { frequency: 12 },
                        'cost_optimization': { frequency: 8 },
                        'user_experience': { frequency: 10 },
                        'ai_routing': { frequency: 14 }
                    },
                    personality_profile: {
                        traits: {
                            openness: 0.85,
                            conscientiousness: 0.9,
                            extraversion: 0.7
                        },
                        expertise_areas: ['ai_ml', 'business_strategy', 'software_engineering']
                    },
                    business_insights: {
                        strategic_focus: ['product_strategy', 'technology_strategy'],
                        growth_mindset: 'aggressive'
                    }
                },
                clusters: {
                    business_strategy: {
                        conversations: 15,
                        key_insights: [
                            'Focus on trust-native platform development',
                            'Prioritize cost optimization for user value',
                            'Emphasize AI routing intelligence'
                        ]
                    },
                    technical_discussions: {
                        conversations: 22,
                        key_insights: [
                            'Strong emphasis on modular architecture',
                            'Real-time routing optimization',
                            'Trust score integration patterns'
                        ]
                    }
                }
            };
        }

        function displayResults(analysis) {
            analysisData = analysis;
            
            processing.style.display = 'none';
            results.style.display = 'block';

            // Populate metrics
            populateMetrics(analysis);
            
            // Populate themes
            populateThemes(analysis.analysis.strategic_themes);
            
            // Populate insights
            populateInsights(analysis.clusters);
            
            // Populate personality profile
            populatePersonalityProfile(analysis.analysis.personality_profile);
        }

        function populateMetrics(analysis) {
            const metricsGrid = document.getElementById('metricsGrid');
            
            const metrics = [
                { 
                    value: analysis.totalMessages, 
                    label: 'Messages Analyzed' 
                },
                { 
                    value: Object.keys(analysis.analysis.strategic_themes).length, 
                    label: 'Themes Identified' 
                },
                { 
                    value: analysis.analysis.personality_profile.expertise_areas.length, 
                    label: 'Expertise Areas' 
                },
                { 
                    value: Math.round(analysis.analysis.personality_profile.traits.conscientiousness * 100) + '%', 
                    label: 'Conscientiousness' 
                }
            ];

            metricsGrid.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        function populateThemes(themes) {
            const themesGrid = document.getElementById('themesGrid');
            
            themesGrid.innerHTML = Object.entries(themes).map(([theme, data]) => `
                <div class="theme-card">
                    <div class="theme-name">${theme.replace('_', ' ').toUpperCase()}</div>
                    <div class="theme-frequency">${data.frequency} mentions</div>
                </div>
            `).join('');
        }

        function populateInsights(clusters) {
            const insightsList = document.getElementById('insightsList');
            
            const allInsights = [];
            Object.values(clusters).forEach(cluster => {
                allInsights.push(...cluster.key_insights);
            });

            insightsList.innerHTML = allInsights.slice(0, 8).map(insight => `
                <li>${insight}</li>
            `).join('');
        }

        function populatePersonalityProfile(profile) {
            const profileDiv = document.getElementById('personalityProfile');
            
            profileDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>Personality Traits</h4>
                    ${Object.entries(profile.traits).map(([trait, score]) => `
                        <div style="margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>${trait.charAt(0).toUpperCase() + trait.slice(1)}</span>
                                <span>${Math.round(score * 100)}%</span>
                            </div>
                            <div style="background: #f0f0f0; height: 8px; border-radius: 4px;">
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: ${score * 100}%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div>
                    <h4>Expertise Areas</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${profile.expertise_areas.map(area => `
                            <span style="background: #667eea; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9em;">
                                ${area.replace('_', ' ')}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function exportReport(format) {
            if (!analysisData) return;

            switch (format) {
                case 'pdf':
                    generatePDFReport();
                    break;
                case 'csv':
                    downloadCSV();
                    break;
                case 'json':
                    downloadJSON();
                    break;
                case 'mobile':
                    showMobilePreview();
                    break;
            }
        }

        function generatePDFReport() {
            // In a real implementation, this would generate a proper PDF
            const reportContent = generateHTMLReport();
            const newWindow = window.open('', '_blank');
            newWindow.document.write(reportContent);
            newWindow.document.close();
            newWindow.print();
        }

        function generateHTMLReport() {
            return `
<!DOCTYPE html>
<html>
<head>
    <title>Soulfra Chat Analysis Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        h1 { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        h2 { color: #333; margin-top: 30px; }
        .metric { background: #f8f9ff; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .insight { background: #fff; border-left: 4px solid #667eea; padding: 10px 15px; margin: 8px 0; }
    </style>
</head>
<body>
    <h1>üìä Soulfra Chat Analysis Report</h1>
    
    <h2>Overview</h2>
    <div class="metric">
        <strong>Total Messages:</strong> ${analysisData.totalMessages}<br>
        <strong>Themes Identified:</strong> ${Object.keys(analysisData.analysis.strategic_themes).length}<br>
        <strong>Communication Style:</strong> ${analysisData.analysis.communication_patterns.response_style}
    </div>

    <h2>Strategic Themes</h2>
    ${Object.entries(analysisData.analysis.strategic_themes).map(([theme, data]) => `
        <div class="insight">
            <strong>${theme.replace('_', ' ').toUpperCase()}</strong>: ${data.frequency} mentions
        </div>
    `).join('')}

    <h2>Key Insights</h2>
    ${Object.values(analysisData.clusters).map(cluster => 
        cluster.key_insights.map(insight => `<div class="insight">${insight}</div>`).join('')
    ).join('')}

    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
        Generated by Soulfra Chat Analyzer - ${new Date().toLocaleDateString()}
    </footer>
</body>
</html>`;
        }

        function downloadCSV() {
            const csvData = [];
            
            // Add themes data
            Object.entries(analysisData.analysis.strategic_themes).forEach(([theme, data]) => {
                csvData.push({
                    category: 'Strategic Theme',
                    item: theme,
                    frequency: data.frequency,
                    notes: 'Strategic priority'
                });
            });

            // Add insights data
            Object.entries(analysisData.clusters).forEach(([category, cluster]) => {
                cluster.key_insights.forEach(insight => {
                    csvData.push({
                        category: 'Key Insight',
                        item: insight,
                        frequency: 1,
                        notes: category
                    });
                });
            });

            const csv = convertToCSV(csvData);
            downloadFile(csv, 'soulfra_analysis.csv', 'text/csv');
        }

        function downloadJSON() {
            const json = JSON.stringify(analysisData, null, 2);
            downloadFile(json, 'soulfra_analysis.json', 'application/json');
        }

        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
            ].join('\n');
            return csvContent;
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function showMobilePreview() {
            const mobileHTML = generateMobileHTML();
            const newWindow = window.open('', '_blank', 'width=375,height=667');
            newWindow.document.write(mobileHTML);
            newWindow.document.close();
        }

        function generateMobileHTML() {
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± Mobile Analysis</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            line-height: 1.6;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            margin: 10px 0;
        }
        .metric-value { font-size: 2em; font-weight: bold; }
        .metric-label { font-size: 0.9em; opacity: 0.9; }
        h2 { color: #333; font-size: 1.3em; margin-bottom: 15px; }
        .theme { background: #f0f4ff; padding: 10px; border-radius: 6px; margin: 8px 0; }
        .insight { background: #fff8f0; padding: 10px; border-left: 3px solid #667eea; margin: 8px 0; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üìä Quick Stats</h2>
        <div class="metric">
            <div class="metric-value">${analysisData.totalMessages}</div>
            <div class="metric-label">Messages</div>
        </div>
        <div class="metric">
            <div class="metric-value">${Object.keys(analysisData.analysis.strategic_themes).length}</div>
            <div class="metric-label">Themes</div>
        </div>
    </div>

    <div class="card">
        <h2>üéØ Top Themes</h2>
        ${Object.entries(analysisData.analysis.strategic_themes)
            .sort(([,a], [,b]) => b.frequency - a.frequency)
            .slice(0, 3)
            .map(([theme, data]) => `
                <div class="theme">
                    <strong>${theme.replace('_', ' ')}</strong><br>
                    ${data.frequency} mentions
                </div>
            `).join('')}
    </div>

    <div class="card">
        <h2>üí° Key Insights</h2>
        ${Object.values(analysisData.clusters)
            .map(cluster => cluster.key_insights.slice(0, 2))
            .flat()
            .slice(0, 4)
            .map(insight => `<div class="insight">${insight}</div>`)
            .join('')}
    </div>

    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 0.9em;">
        Generated by Soulfra üß†<br>
        ${new Date().toLocaleDateString()}
    </div>
</body>
</html>`;
        }

        function showError(message) {
            processing.style.display = 'none';
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').appendChild(errorDiv);
        }

        // Add some sample data for demo
        function loadSampleData() {
            const sampleAnalysis = generateMockAnalysis([], 'sample_chat.json');
            displayResults(sampleAnalysis);
        }

        // Add demo button
        document.addEventListener('DOMContentLoaded', function() {
            const demoButton = document.createElement('button');
            demoButton.textContent = 'üéØ Try Demo';
            demoButton.className = 'btn';
            demoButton.style.marginLeft = '10px';
            demoButton.onclick = loadSampleData;
            document.querySelector('.upload-zone').appendChild(demoButton);
        });
    </script>
</body>
</html>